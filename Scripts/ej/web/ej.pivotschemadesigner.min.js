/*!
*  filename: ej.pivotschemadesigner.min.js
*  version : 15.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2017. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./ej.menu.min","./ej.togglebutton.min","./ej.button.min","./ej.checkbox.min","./ej.dialog.min","./ej.maskedit.min","./ej.waitingpopup.min","./ej.treeview.min","./../datavisualization/ej.chart.min"],n):n()})(function(){(function(n,t,i){t.widget("ejPivotSchemaDesigner","ej.PivotSchemaDesigner",{_rootCSS:"e-pivotschemadesigner",element:null,model:null,_requiresID:!0,validTags:["div","span"],defaults:{url:"",cssClass:"",height:"630px",width:"415px",locale:"en-US",layout:"excel",enableRTL:!1,pivotControl:null,pivotTableFields:[],pivotCalculations:[],pivotColumns:[],pivotRows:[],filters:[],olap:{showKpi:!1,showNamedSets:!1},enableWrapper:!1,enableDragDrop:!0,serviceMethods:{fetchMembers:"FetchMembers",nodeStateModified:"NodeStateModified",nodeDropped:"NodeDropped",removeButton:"RemoveButton",memberExpand:"MemberExpanded",filtering:"filtering",sorting:"sorting"},customObject:{},beforeServiceInvoke:null,afterServiceInvoke:null,dragMove:null,applyFieldCaption:null},dataTypes:{serviceMethods:"data",customObject:"data",pivotControl:"data",pivotTableFieldList:"array",pivotCalculationList:"array",pivotColumnList:"array",pivotRowList:"array",filterList:"array"},locale:t.util.valueFunction("locale"),_init:function(){this._initPrivateProperties();this._load()},_destroy:function(){this.element.empty().removeClass("e-pivotschemadesigner"+this.model.cssClass)},_initPrivateProperties:function(){this._id=this.element.attr("id");this._dialogTitle="";this._currentMembers=[];this._memberTreeObj=null;this._tableTreeObj=null;this._dialogOKBtnObj=null;this._curFilteredText="";this._curFilteredAxis="";this._tempFilterData=null;this._droppedClass="";this._selectedTreeNode=null;this._selectedMember="";this._selectedLevel="";this._isDragging=!1;this._dataModel="";this._droppedPosition="";this._currentCubeName="";this._errorDialog="";this._nodeDropedParams="";this._contextMenuObj=null;this._removeButtonDeferUpdate=!1;this._isMeasureBtnRemove=!1;this._nodeCheck=!1;this._isFiltered=!1;this._curFocus={tree:null,node:null,tab:null,button:null};this._index={tree:0,node:0,tab:0,button:0};this._selectedFieldName="";this._selectedFieldCaption="";this._selectedFieldAxis="";this._isDropAction=!1;this._ascdes="";this._pivotClientObj=null;this._memberPageSettings={currentMemeberPage:1,startPage:0,endPage:0};this._isAllMemberChecked=!0;this._editorTreeData=[];this._memberPagingAvdData=[]},_load:function(){var u="",r,e,o,w,f;if(this.model.pivotControl!=null&&(this.model.pivotControl._schemaData=this,n(this.element).parents(".e-pivotclient").length>0&&(this._pivotClientObj=n(this.element).parents(".e-pivotclient").data("ejPivotClient")),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(u=JSON.parse(JSON.parse(this.model.pivotControl.getOlapReport()).ItemsProperties),r=JSON.parse(this.model.pivotControl.getOlapReport()),this.model.pivotControl._dataModel=="Pivot"?(r=this.model.pivotControl._filterReport(r),e=r.PivotRows.concat(r.PivotColumns,r.PivotCalculations,r.Filters),o=n.grep(u,function(t){return n.grep(e,function(n){t.id==(n.FieldHeader||n.DimensionHeader)&&(t.id=n.FieldName||n.DimensionName)}),t}),this._setTableFields(o)):this._setTableFields(u),this._setPivotRows(r.PivotRows),this._setPivotColumns(r.PivotColumns),this._setPivotCalculations(r.PivotCalculations),this._setFilters(r.Filters),this._dataModel=r.DataModel,this._currentCubeName=r.CurrentCube):(r=this.model.pivotControl.model.dataSource,this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(this.model.pivotTableFields=t.PivotAnalysis.getTreeViewData(this.model.pivotControl.model.dataSource))),this._trigger("load",{element:this.element}),this.model._waitingPopup?this._waitingPopup=this.model._waitingPopup:(n("#"+this._id).ejWaitingPopup({showOnInit:!0}),this._waitingPopup=n("#"+this._id).data("ejWaitingPopup")),this.element.width(this.model.width).height(this.model.height),this._waitingPopup.show()),this.model.enableWrapper)this.element.show(),this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this._refreshPivotButtons():(this._setFilters(r.Filters),this._refreshPivotButtons(),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.element.append(t.buildTag("div.deferUpdateLayout",t.buildTag("input.chkDeferUpdate","",{}).attr("type","checkbox")[0].outerHTML+t.buildTag("button.btnDeferUpdate",this._getLocalizedLabels("Update"),{}).attr("type","button")[0].outerHTML)[0].outerHTML),this.model.pivotControl!=null&&this.model.enableDragDrop&&this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)})),this._reSizeHandler();else{var s=(this.model.layout=="onebyone"?"":t.buildTag("table.headerTable",t.buildTag("tr",t.buildTag("td",t.buildTag("div.listHeader",t.buildTag("span.headerText",this._getLocalizedLabels("PivotTableFieldList"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.listSubhead",t.buildTag("span.subheadText",this._getLocalizedLabels("ChooseFieldsToAddToReport"),{})[0].outerHTML,{})[0].outerHTML,{}).attr("valign","top")[0].outerHTML,{})[0].outerHTML,{width:"100%",height:"10%"})[0].outerHTML)+t.buildTag("div.fieldTable",(this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?t.buildTag("div.cubelists",t.buildTag("input#cubeList.cubeList").attr("type","text")[0].outerHTML)[0].outerHTML:"")+t.buildTag("div.parentSchemaFieldTree",t.buildTag("div.schemaFieldTree#"+this._id+"_schemaFieldTree",{},{width:"100%"})[0].outerHTML).attr("valign","top")[0].outerHTML).attr("overflow","auto")[0].outerHTML,h=t.buildTag("div.axisTd1",t.buildTag("div.pivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("ReportFilter"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaFilter",t.buildTag("p#reportfilter","report filter",{display:"none"})[0].outerHTML+this._createPivotButtons("filters",this.model.filters)).attr("aria-describedby","reportfilter").attr("aria-dropeffect","none").attr("aria-selected","false")[0].outerHTML,{})[0].outerHTML,c=t.buildTag("div.axisTd2",t.buildTag("div.rPivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("ColumnLabel"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaColumn",t.buildTag("p#columnlabel","column label",{display:"none"})[0].outerHTML+this._createPivotButtons("columns",this.model.pivotColumns)+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="columns"?this._createPivotButtons("columns",[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}]):""),{})[0].outerHTML,{}).attr("aria-describedby","columnlabel").attr("aria-dropeffect","none").attr("aria-selected","false")[0].outerHTML,l=t.buildTag("div.axisTd1#axisTd",t.buildTag("div.pivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("RowLabel"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaRow",t.buildTag("p#rowlabel","row label",{display:"none"})[0].outerHTML+this._createPivotButtons("rows",this.model.pivotRows)+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="rows"?this._createPivotButtons("rows",[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}]):""),{})[0].outerHTML,{}).attr("aria-describedby","rowlabel").attr("aria-dropeffect","none").attr("aria-selected","false")[0].outerHTML,a=t.buildTag("div.axisTd2#axisTd3",t.buildTag("div.rPivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("Values"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaValue",t.buildTag("p#valuelabel","values",{display:"none"})[0].outerHTML+this._createPivotButtons("values",this.model.pivotCalculations),{}).attr("aria-describedby","valuelabel").attr("aria-dropeffect","none").attr("aria-selected","false")[0].outerHTML,{})[0].outerHTML,v=t.buildTag("div.axisTable",this.model.layout=="onebyone"?c+l+h+a:t.buildTag("div",h+c,{})[0].outerHTML+t.buildTag("div",l+a,{})[0].outerHTML,this.model.enableRTL&&this.model.layout=="onebyone"?{position:"relative",left:this._pivotClientObj.model.enableSplitter?"":"7px"}:{})[0].outerHTML,y=t.buildTag("div.deferUpdateLayout",t.buildTag("input.chkDeferUpdate","",{}).attr("type","checkbox")[0].outerHTML+t.buildTag("button.btnDeferUpdate",this._getLocalizedLabels("Update"),{}).attr("type","button")[0].outerHTML)[0].outerHTML,p;p=this.model.enableRTL&&this.element.parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableSplitter?v+(this.model.layout=="onebyone"?"":t.buildTag("div.centerDiv")[0].outerHTML+t.buildTag("div.centerHead",this._getLocalizedLabels("DragFieldBetweenAreasBelow"))[0].outerHTML)+s+(n(this.element).parents(".e-pivotclient").length>0?"":t.buildTag("span.responsiveSchema","")[0].outerHTML)+(this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&n(this.element).parents(".e-pivotclient").length==0?y:"")+(n(this.element).parents(".e-pivotclient").length>0?"":t.buildTag("div.schemaNoClick","")[0].outerHTML):s+(this.model.layout=="onebyone"?"":t.buildTag("div.centerDiv")[0].outerHTML+t.buildTag("div.centerHead",this._getLocalizedLabels("DragFieldBetweenAreasBelow"))[0].outerHTML)+v+(n(this.element).parents(".e-pivotclient").length>0?"":t.buildTag("span.responsiveSchema","")[0].outerHTML)+(this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&n(this.element).parents(".e-pivotclient").length==0?y:"")+(n(this.element).parents(".e-pivotclient").length>0?"":t.buildTag("div.schemaNoClick","")[0].outerHTML);n(p).appendTo("#"+this._id);this.element.parents(".e-pivotclient").length>0&&!this._pivotClientObj.model.enableSplitter&&(this._pivotClientObj.model.isResponsive&&this.element.find(".fieldTable").addClass("addedFieldTable"),this.model.enableRTL||this.element.find(".fieldTable").addClass("fieldDisSplitTable"));this.element.parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableSplitter&&this.element.find(".fieldTable").addClass("fieldEnSplitTable");this.model.enableRTL&&this.element.parents(".e-pivotclient").length>0&&(this.element.find(".fieldTable").addClass("clientFieldTable"),this.element.find(".fieldTable").addClass("rtlSplitTable"),this.element.parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableSplitter&&this.element.find(".axisTable").addClass("clientAxisSplitterTable"));this.model.pivotControl!=null?((this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode||this.model.pivotControl.element.hasClass("e-pivotclient"))&&this._refreshPivotButtons(),this._reSizeHandler()):this.element.hide()}this.model.enableDragDrop&&this.model.pivotControl&&this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)});this.element.find(".pivotButton .filterBtn").ejButton({size:"normal",enableRTL:this.model.enableRTL,type:t.ButtonType.Button,contentType:"imageonly",prefixIcon:"filter"});this.model.pivotControl&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&(w={url:this.model.pivotControl.model.dataSource.data,cube:this.model.pivotControl.model.dataSource.cube,catalog:this.model.pivotControl.model.dataSource.catalog,request:"MDSCHEMA_CUBES"},t.Pivot._getTreeData(w,t.Pivot.getCubeList,{pvtCtrldObj:this,action:"loadcubelist",hierarchy:this._selectedField}),this.element.find(".cubeList").ejDropDownList({dataSource:this.model.cubeCollection,enableRTL:this.model.enableRTL,fields:{text:"name",value:"name"},width:"100%",height:"27px",change:t.proxy(this._cubeChanged,this),create:function(){n(this.wrapper.find(".e-input")).focus(function(){n(this).blur()})}}),f=this.element.find(".cubeList").data("ejDropDownList"),t.isNullOrUndefined(f)||f.selectItemByText(this.model.pivotControl.model.dataSource.cube));this.element.find(".pivotButton input").ejToggleButton({size:"normal",enableRTL:this.model.enableRTL,contentType:"imageonly",defaultPrefixIcon:"ascending",activePrefixIcon:"descending",click:t.proxy(this._sortBtnClick,this)});this.model.pivotControl!=null&&(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot||this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?this._createTreeView(this,this.model.pivotTableFields):t.Pivot.generateTreeViewData(this));this.model.enableRTL&&this.element.addClass("e-rtl");this._createContextMenu();this._waitingPopup&&this._waitingPopup.hide();this._setPivotBtnWidth()},setCubeList:function(n){this.model.cubeCollection=n},refreshControl:function(){var i,t;for(n(this._tableTreeObj.element).ejTreeView("unCheckAll"),this._isDropAction=!0,i=this.model.pivotControl.model.dataSource,t=0;t<i.rows.length;t++)this._tableTreeObj.checkNode(this._tableTreeObj.element.find("li[tag='"+i.rows[t].fieldName+"']"));for(t=0;t<i.columns.length;t++)this._tableTreeObj.checkNode(this._tableTreeObj.element.find("li[tag='"+i.columns[t].fieldName+"']"));for(t=0;t<i.filters.length;t++)this._tableTreeObj.checkNode(this._tableTreeObj.element.find("li[tag='"+i.filters[t].fieldName+"']"));for(t=0;t<i.values.length;t++)this._tableTreeObj.checkNode(this._tableTreeObj.element.find("li[tag='"+i.values[t].fieldName+"']"));this._isDropAction=!1;this._refreshPivotButtons()},_cubeChanged:function(i){this.model.pivotControl.model.dataSource.cube!=i.selectedValue&&(this._pivotClientObj._waitingPopup&&setTimeout(function(){var t=n(i.target).parents(".e-pivotclient").length>0?n(i.target).parents(".e-pivotclient").data("ejPivotClient"):n(this.element).parents(".e-pivotclient").data("ejPivotClient");t._waitingPopup.show()},0),this.model.pivotControl.model.dataSource.cube=i.selectedValue,this.model.pivotControl.model.dataSource.rows=this.model.pivotControl.model.dataSource.columns=this.model.pivotControl.model.dataSource.values=this.model.pivotControl.model.dataSource.filters=[],delete this.model.pivotControl._fieldData,this.element.find(".pivotButton").remove(),this.element.find(".schemaFieldTree").empty(),t.Pivot.generateTreeViewData(this,this.model.pivotControl.model.dataSource),this._pivotClientObj.refreshControl())},_setPivotBtnWidth:function(){if(this.model.layout!="excel"&&this.model.pivotControl){var r=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?!0:!1,u=r?this._dataModel:this.model.pivotControl._dataModel,i=u=="Olap"||u=="XMLA"?15:20;n.each(this.element.find(".schemaRow .pvtBtn,.schemaColumn .pvtBtn"),function(t,u){n(u).attr("aria-describedby")=="Measures"?n(u).width(n(u).parent().width()-i-10):(n(u).width(n(u).parent().width()-3*i),this._dataModel!="Pivot"&&r&&n(".pivotButton:contains('"+n(u).text()+"'):first").find(".filtered").length>0&&n(u).parent().find(".filter").addClass("filtered"))});n.each(this.element.find(".schemaValue .pvtBtn"),function(t,r){n(r).width(n(r).parent().width()-i-10)});n.each(this.element.find(".schemaFilter .pvtBtn"),function(t,u){n(u).width(n(u).parent().width()-2*i-10);this._dataModel!="Pivot"&&r&&n(".pivotButton:contains('"+n(u).text()+"'):first").find(".filtered").length>0&&n(u).parent().find(".filter").addClass("filtered")})}else n.each(this.element.find(".pvtBtn"),function(t,i){n(i).width(n(i).parent().width()-15)})},_onContextOpen:function(i){n(i.target).hasClass("removeClientPivotBtn")||t.Pivot._contextMenuOpen(i,this)},_contextClick:function(i){var r,f,u;schemaObj=this;r=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null;t.isNullOrUndefined(r)?this.model.pivotControl._waitingPopup.show():(r._isTimeOut=!0,setTimeout(function(){r._isTimeOut&&schemaObj.model.pivotControl._waitingPopup.show()},800));f=i.text==this._getLocalizedLabels("AddToColumn")?this.element.find(".schemaColumn"):i.text==this._getLocalizedLabels("AddToRow")?this.element.find(".schemaRow"):i.text==this._getLocalizedLabels("AddToValues")?this.element.find(".schemaValue"):i.text==this._getLocalizedLabels("AddToFilter")?this.element.find(".schemaFilter"):"";u={element:this._selectedMember,target:f[0],cancel:!1};this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped(u):this._clientOnPvtBtnDropped(u)},_createTreeView:function(r,u){var f,c,e,l,a,o,s,v,h;for(this.element.find(".schemaFieldTree").ejTreeView({showCheckbox:this.model.layout=="onebyone"?!1:!0,fields:{id:"id",parentId:"pid",text:this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"name":"caption",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:u},enableRTL:this.model.enableRTL,allowDragAndDrop:this.model.enableDragDrop?!0:!1,allowDropChild:!1,allowDropSibling:!1,dragAndDropAcrossControl:!0,beforeDelete:function(){return!1},cssClass:"pivotTreeViewDragedNode",nodeDropped:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._nodeDropped:this._clientOnNodeDropped,this),nodeDragStart:t.proxy(this._nodeDrag,this),nodeDrag:t.proxy(this._nodeDraged,this)}),f=[],c=this.model.pivotControl.model.dataSource.providerName==t.olap.Providers.Mondrian,this._tableTreeObj=this.element.find(".schemaFieldTree").data("ejTreeView"),this._tableTreeObj.element.find(".e-ul").css({width:"100%",height:"100%"}),this._tableTreeObj.element.find(".measureGroupCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".folderCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".dimensionCDB").parent().siblings(".e-chkbox-wrap").remove(),this.model.layout!=t.PivotSchemaDesigner.Layouts.OneByOne&&(this._tableTreeObj.element.find(".measureGroupCDB").parents("li").length==0?this._tableTreeObj.element.find("#\\[Measures\\]").append(t.buildTag("span.elementSeparator")[0].outerHTML):this._tableTreeObj.element.find(".measureGroupCDB").parents("li").append(t.buildTag("span.elementSeparator")[0].outerHTML),this._tableTreeObj.element.find(".dimensionCDB").parents("li").append(t.buildTag("span.elementSeparator")[0].outerHTML)),this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&(f=this._tableTreeObj.element,n.map(u,function(t){t.defaultHierarchy&&n(f).find("li[id='"+t.tag+"']").attr("defaultHierarchy",t.defaultHierarchy)})),f=this._tableTreeObj.element.find("li"),e=0;e<f.length;e++)l=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?c?n(f[e]).attr("id").split("~#^")[0]:n(f[e]).attr("id"):this.model.pivotTableFields[e].tag,f[e].setAttribute("tag",l),a=n(f[e]).find(".e-chkbox-wrap"),n(a[0]).attr("aria-checked")=="true"&&n(n(f[e])).find(".folderCDB").length<=0&&n(f[e]).attr("tag").toLowerCase().indexOf("[measures]")==-1&&(this.model.pivotControl._dataModel=="XMLA"?n(f[e]).parents("li:eq(0)").length>0&&n(f[e]).parents("li:eq(0)").attr("tag").toLowerCase().indexOf("[measures]")==-1&&(o=t.Pivot.getReportItemByFieldName(n(f[e]).attr("tag"),this.model.pivotControl.model.dataSource,this._dataModel).item,!t.isNullOrUndefined(o)>0&&(o.isNamedSets==i||!o.isNamedSets)&&(s=t.buildTag("span.e-icon").css("display","inline-block").addClass("treeDrop").attr("role","button").attr("aria-label","filter button")[0].outerHTML,n(n(f[e]).find(".e-text")[0]).after(s))):(s=t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML,n(n(f[e]).find(".e-text")[0]).after(s)));this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(this._tableTreeObj.model.nodeCheck=t.proxy(this._clientPivotCheckedStateModified,this),this._tableTreeObj.model.nodeUncheck=t.proxy(this._clientPivotCheckedStateModified,this)):(this._tableTreeObj.model.nodeCheck=t.proxy(this._checkedStateModified,this),this._tableTreeObj.model.nodeUncheck=t.proxy(this._checkedStateModified,this));this._tableTreeObj.element.find(".attributeCDB").parent().siblings("ul").remove();this._tableTreeObj.element.find(".attributeCDB").closest("div").find(".e-plus").remove();this._tableTreeObj.element.find(".hierarchyCDB").parent().parent().siblings("ul").find(".e-chkbox-wrap").remove();this._tableTreeObj.element.find(".e-plus").length==0&&this._tableTreeObj.element.find(".e-item").css("padding","0px");this.element.find(".schemaFilter, .schemaColumn, .schemaRow, .schemaValue").ejDroppable({});this.model.pivotControl!=null&&(v=t.buildTag("ul.pivotTreeContext#pivotTreeContext",t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToFilter"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToRow"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToColumn"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToValues"))[0].outerHTML)[0].outerHTML)[0].outerHTML,n(this.element).append(v),n("#pivotTreeContext").ejMenu({menuType:t.MenuType.ContextMenu,openOnClick:!1,enableRTL:this.model.enableRTL,contextMenuTarget:this._tableTreeObj.element,click:t.proxy(this._treeContextClick,this),beforeOpen:t.proxy(this._contextOpen,this),close:t.proxy(t.Pivot.closePreventPanel,this)}));this.model.pivotControl!=null&&(h=!1,this.model.pivotControl.model.enableDeferUpdate&&(h=!0),this.element.find(".btnDeferUpdate").ejButton({size:"mini",type:t.ButtonType.Button,enabled:h,click:t.proxy(this.model.pivotControl._deferUpdate,this.model.pivotControl)}),this.element.find(".chkDeferUpdate").ejCheckBox({text:this._getLocalizedLabels("DeferLayoutUpdate"),change:this._checkedChange,size:"normal",checked:h}));this._waitingPopup.hide();this._unWireEvents();this._wireEvents()},_nodeDraged:function(n){this._trigger("dragMove",n)},_setFirst:!0,_setModel:function(t){for(var i in t)switch(i){case"OlapReport":this.setOlapReport(t[i]);break;case"locale":this._load();break;case"locale":case"enableRTL":n(this.element).html("");this._load()}},_wireEvents:function(){this._on(n(document),"keydown",this._keyDownPress);this._on(n(document),"keyup",t.proxy(function(n){n.keyCode===93&&n.preventDefault()}));this.model.layout!="excel"&&this.model.layout!=t.PivotSchemaDesigner.Layouts.OneByOne&&(this._on(this.element,"mouseover",".pivotButton .pvtBtnDiv",t.proxy(function(t){this._isDragging||n(t.target).find("button").removeClass("e-hoverBtn").addClass("e-hoverBtn")},this)),this._on(this.element,"mouseleave",".pivotButton .pvtBtnDiv",t.proxy(function(t){n(t.target).find("button").length>0?n(t.target).find("button").removeClass("e-hoverBtn"):n(t.target).removeClass("e-hoverBtn")},this)),this._on(this.element,"mouseover",".filter,.sorting,.removeBtn",t.proxy(function(t){this._isDragging||n(t.target.parentElement).find("button").removeClass("e-hoverBtn").addClass("e-hoverBtn")},this)),this._on(this.element,"mouseleave",".filter,.sorting,.removeBtn",t.proxy(function(t){n(t.target.parentElement).find("button").removeClass("e-hoverBtn")},this)));this._on(this.element,"mouseover",".pvtBtnDiv .pvtBtn",t.proxy(function(t){this._isDragging&&(this.element.find(".dropIndicator").removeClass("dropIndicatorHover"),n(t.target).parent().siblings(".dropIndicator").addClass("dropIndicatorHover"))},this));this._on(this.element,"click","#preventDiv",t.proxy(function(){this.element.find(".e-dialog.advancedFilterDlg:visible").length>0&&(this.element.find(".e-dialog.advancedFilterDlg").hide(),this.element.find("#preventDiv").remove())},this));this._on(this.element,"mouseleave",".pivotButton",t.proxy(function(t){this._isDragging&&n(t.target).siblings(".dropIndicator").removeClass("dropIndicatorHover")},this));this._on(this.element,"mouseover",".pivotButton",t.proxy(function(t){n(t.target).attr("title",t.target.textContent)},this));this._tableTreeObj.element.find("li").mouseover(t.proxy(function(i){var u,r;n(i.target).siblings("span.e-icon.filter:eq(0)").length>0||n(i.target).find("span.e-icon.filter:eq(0)").length>0||n(i.target).parentsUntil("li").find("span.e-icon.filter:eq(0)").length>0?(u="-31px",this.element.find("span.e-icon.filter").attr("role","button").attr("aria-label","filtered")):(u="-20px",this.element.find("span.e-icon.treeDrop").attr("role","button").attr("aria-label","filter button"));r=n(i.target).siblings("span.e-icon.filter:eq(0)").length>0||n(i.target).find("span.e-icon.filter:eq(0)").length>0||n(i.target).parentsUntil("li").find("span.e-icon.filter:eq(0)").length>0?10:5;this.model.enableRTL?this.model.pivotControl.model.analysisMode!=t.Pivot.AnalysisMode.Pivot?n(i.target).siblings("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).siblings("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute",top:n(i.target).hasClass("filter")?n(i.target).position().top-22:n(i.target).position().top+2,left:n(i.target).hasClass("filter")?n(i.target).position().left+(6-r):(n(i.target).attr("role")==""?n(i.target).position().left:-2)+(5-r)}):n(i.target).find("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute"}):n(i.target).parentsUntil("li").find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute"}):n(i.target).siblings("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).siblings("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute",top:n(i.target).hasClass("filter")?n(i.target).position().top-22:n(i.target).position().top+2,left:n(i.target).hasClass("filter")?n(i.target).position().left+(7-r):n(i.target).position().left+(10-r)}):n(i.target).find("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute"}):n(i.target).parentsUntil("li").find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute"}):n(i.target).siblings("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).siblings("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"static","margin-left":u}):n(i.target).find("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"static"}):n(i.target).parentsUntil("li").find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"static"});n(i.target).parent().find(".measureGroupCDB, .folderCDB",this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?"":".dimensionCDB").length>0&&n(i.target).css("cursor","default")},this)).mouseout(t.proxy(function(){n(this._tableTreeObj.element).find("span.e-icon.treeDrop").css({display:"none"})},this));this._on(this.element,"click",".filterBtn,.filter",t.proxy(this._filterBtnClickCommon,this));this._on(this.element,"click",".sorting",t.proxy(this._sortBtnClick,this));this._on(this.element,"click",".removeBtn",t.proxy(this._removePvtBtn,this));this._on(this.element,"click",".pvtBtn",t.proxy(this._filterBtnClickCommon,this));this._on(this._tableTreeObj.element,"click",".treeDrop",t.proxy(this._filterBtnClickCommon,this));this._on(this.element,"click",".removeClientPivotBtn",t.proxy(this._removeBtnClick,this));this._on(this.element,"click",".removePivotBtn",t.proxy(this._removeBtnClick,this));this._on(this.element,"click",".ascOrder, .descOrder",t.proxy(this._sortField,this));this._on(this.element,"click",".collapseSchema",t.proxy(this._hideSchemaDesigner,this));this._on(this.element,"click",".expandSchema",t.proxy(this._showSchemaDesigner,this));this._on(this.element,"click",".nextPage, .prevPage, .firstPage, .lastPage",t.proxy(this._navigateTreeData,this));this._on(this.element,"click",".searchEditorTree",t.proxy(function(n){t.Pivot._searchEditorTreeNodes(n,this)},this));n(window).on("resize",n.proxy(this._reSizeHandler,this))},_navigateTreeData:function(n){t.Pivot.editorTreeNavigatee(n,this)},_filterBtnClickCommon:function(i){if(n(i.target).hasClass("pvtBtn")&&this.element.parents(".e-pivotclient").length>0||n(i.target).hasClass("treeDrop")||n(i.target).hasClass("filter"))if(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode)this._clientOnFilterBtnClick(i);else if(this.model.pivotControl.model.operationalMode!=t.Pivot.OperationalMode.ServerMode||t.isNullOrUndefined(n(i.target.nextElementSibling)))this._filterBtnClick(i);else{if(n(i.target.nextElementSibling).hasClass("treeDrop"))return!1;this._filterBtnClick(i)}},_unWireEvents:function(){this._off(this.element,"click",".filterBtn, .ascOrder, .descOrder");this._off(n(document),"keydown",this._keyDownPress);this._off(n(document),"keyup");this._off(this.element,"click","#preventDiv");this._off(this.element,"mouseover",".pivotButton");this._off(this.element,"mouseover",".pivotButton .pvtBtn");this._off(this.element,"mouseleave",".pivotButton");this._off(this.element,"click",".sorting");this._off(this.element,"click",".filter");this._off(this.element,"click",".removeBtn,.removeClientPivotBtn");this._off(this.element,"mouseover",".schemaFieldTree li");this._off(this.element,"mouseout",".schemaFieldTree li");this._off(this._tableTreeObj.element,"click",".treeDrop");this._off(this.element,"click",".ascOrder, .descOrder",t.proxy(this._sortField,this));this._off(this.element,"click",".filterBtn");this._off(this.element,"click",".pvtBtn");this._off(this._tableTreeObj.element,"click",".treeDrop");this._off(this._tableTreeObj.element,"click","li");this._off(this.element,"click",".removeClientPivotBtn, .removePivotBtn");n(window).off("resize",n.proxy(this._reSizeHandler,this));this._off(this.element,"click",".nextPage, .prevPage, .firstPage, .lastPage");this._off(this.element,"click",".searchEditorTree")},_keyDownPress:function(i){var r,u,e,f;if((i.keyCode===40||i.which===38)&&(!t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)&&this.model.pivotControl._curFocus.tab.hasClass("e-text")||n("#"+this._id).find(".schemaFieldList .e-text:visible").hasClass("hoverCell"))&&!n(".editorTreeView:visible").length>0&&!n(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0?(n("#"+this._id).find(".hoverCell").removeClass("hoverCell"),this.model.pivotControl._curFocus.tab.mouseleave(),i.preventDefault(),r=n("#"+this._id).find(".schemaFieldTree .e-text:visible"),t.isNullOrUndefined(this._curFocus.tree)?(this._index.tree=i.which==40?1:i.which==38?r.length-1:0,this._curFocus.tree=r.eq(this._index.tree).attr("tabindex","-1")):(this._curFocus.tree.attr("tabindex","0").removeClass("hoverCell").mouseleave(),i.which===40?this._index.tree=this._index.tree+1>r.length-1?0:this._index.tree+1:i.which===38&&(this._index.tree=this._index.tree-1<0?r.length-1:this._index.tree-1),this._curFocus.tree=r.eq(this._index.tree).attr("tabindex","-1")),this._curFocus.tree.focus().addClass("hoverCell").mouseover(),n(".e-node-focus").removeClass("e-node-focus")):(i.which===40||i.which===38||i.which===37||i.which===39)&&!t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)&&this.model.pivotControl._curFocus.tab.hasClass("pvtBtn")&&!n(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0&&document.activeElement.className.startsWith("pvtBtn")?(i.preventDefault(),n("#"+this._id).find(".hoverCell").removeClass("hoverCell"),t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)||this.model.pivotControl._curFocus.tab.mouseleave().attr("tabindex","0").removeClass("hoverCell"),r=n("#"+this._id).find(".pvtBtn"),t.isNullOrUndefined(this._curFocus.button)?i.which===40||i.which===39?this._curFocus.button=r.eq(1).attr("tabindex","-1"):(i.which===38||i.which===37)&&(this._curFocus.button=r.eq(r.length-1).attr("tabindex","-1")):(this._curFocus.button.attr("tabindex","0").removeClass("hoverCell").mouseleave(),i.which===40||i.which===39?this._index.button=this._index.button+1>r.length-1?0:this._index.button+1:(i.which===38||i.which===37)&&(this._index.button=this._index.button-1<0?r.length-1:this._index.button-1),this._curFocus.button=r.eq(this._index.button)),this._curFocus.button.addClass("hoverCell").mouseover().focus()):(i.keyCode===40||i.which===38)&&n("#"+this._id).find(".editorTreeView:visible").length>0&&!t.isNullOrUndefined(n("#"+this._id).find(".e-dialog .e-text"))&&n(".e-dialog .e-text").hasClass("hoverCell")&&(n("#"+this._id).find(".editorTreeView .hoverCell").removeClass("hoverCell"),i.preventDefault(),r=n("#"+this._id).find(".e-dialog .e-text:visible"),t.isNullOrUndefined(this._curFocus.node)?(this._index.node=i.which==40?1:i.which==38?r.length-1:0,this._curFocus.node=r.eq(this._index.node).attr("tabindex","-1")):(this._curFocus.node.attr("tabindex","0").removeClass("hoverCell"),i.which===40?this._index.node=this._index.node+1>r.length-1?0:this._index.node+1:i.which===38&&(this._index.node=this._index.node-1<0?r.length-1:this._index.node-1),this._curFocus.node=r.eq(this._index.node).attr("tabindex","-1")),this._curFocus.node.focus().addClass("hoverCell"),n(".e-node-focus").removeClass("e-node-focus")),(i.which===39||i.which===37)&&n("#"+this._id).find(".schemaFieldTree .e-text:visible").hasClass("hoverCell")&&!n(".editorTreeView:visible").length>0?n("#"+this._id).find(".schemaFieldTree .hoverCell").parent().find(".e-plus,.e-minus").click():(i.which===39||i.which===37)&&n("#"+this._id).find(".editorTreeView .e-text:visible").hasClass("hoverCell")?n("#"+this._id).find(".editorTreeView .hoverCell").parent().find(".e-plus,.e-minus").click():i.which===9&&n("#"+this._id).find(".editorTreeView:visible").length>0&&(i.preventDefault(),n("#"+this._id).find(".e-dialog .hoverCell").removeClass("hoverCell"),this._curFocus.node=null,this._index.node=0,u=[],u.push(n("#"+this._id).find(".e-dialog .e-text").first()),n("#"+this._id).find(".dialogOKBtn:visible").hasClass("e-disable")||u.push(n("#"+this._id).find(".dialogOKBtn:visible")),u.push(n("#"+this._id).find(".dialogCancelBtn:visible")),u.push(n("#"+this._id).find(".e-close:visible")),t.isNullOrUndefined(this._curFocus.tab)?(this._index.tab=1,this._curFocus.tab=u[this._index.tab].attr("tabindex","-1")):(this._curFocus.tab.attr("tabindex","0").removeClass("hoverCell"),this._index.tab=this._index.tab+1>u.length-1?0:this._index.tab+1,this._curFocus.tab=u[this._index.tab].attr("tabindex","-1")),this._curFocus.tab.focus().addClass("hoverCell"),i.stopImmediatePropagation()),i.which===13&&n("#"+this._id).find(".hoverCell").length>0&&!n(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0){if(n("#"+this._id).find(".e-dialog:visible").length>0){if(n(i.target).hasClass("memberCurrentPage")){t.Pivot.editorTreeNavigatee(i,this);return}if(n(i.target).hasClass("searchEditorTreeView")&&n(i.target).parents(".e-dialog").find(".nextPageDiv").length>0){t.Pivot._searchEditorTreeNodes(i,this);return}n("#"+this._id).find(".e-dialog .hoverCell").parent().find(".e-chkbox-small").length>0?n("#"+this._id).find(".e-dialog .hoverCell").parent().find(".e-chkbox-small").click():(n("#"+this._id).find(".e-dialog .hoverCell").click(),this._index.tab=0,t.isNullOrUndefined(this._curFocus.tree)?t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)||this.model.pivotControl._curFocus.tab.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"):this._curFocus.tree.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"))}else n("#"+this._id).find(".schemaFieldTree .hoverCell").length>0?n("#"+this._id).find(".schemaFieldTree .hoverCell").parent().find(".e-chkbox-small").click():n(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0&&(this._curFocus.button&&(e=this._curFocus.button.parent().attr("tag")),this.model.pivotControl._curFocus.button=n("#"+this._id).find("[tag='"+e+"'] button"),this.model.pivotControl._curFocus.button.attr("tabindex","-1").focus().addClass("hoverCell"));n(i.target).hasClass("memberCurrentPage")||n(i.target).hasClass("searchEditorTreeView")&&n(i.target).parents(".e-dialog").find(".nextPageDiv").length>0||i.stopImmediatePropagation()}i.which===70&&i.ctrlKey&&(i.preventDefault(),n("#"+this._id).find(".treeDrop").length>0&&n("#"+this._id).find(".hoverCell").length>0&&n("#"+this._id).find(".hoverCell").parent().find(".treeDrop").click());i.keyCode===93&&n("#"+this._id).find(".hoverCell").length>0&&(i.preventDefault(),f={x:n(".hoverCell").offset().left+n(".hoverCell").outerWidth(),y:n(".hoverCell").offset().top+n(".hoverCell").outerHeight()},n(".hoverCell").trigger({type:"mouseup",which:3,clientX:f.x,clientY:f.y,pageX:f.x,pageY:f.y}));((i.which===79||i.which===67)&&i.ctrlKey||i.which===27)&&n("#"+this._id).find(".hoverCell").length>0&&(i.keyCode==79&&n("#"+this._id).find(".e-dialog").length>0&&i.ctrlKey&&(i.preventDefault(),n("#"+this._id).find(".dialogOKBtn:visible").click()),i.keyCode==67&&n("#"+this._id).find(".e-dialog").length>0&&i.ctrlKey&&(i.preventDefault(),n("#"+this._id).find(".dialogCancelBtn:visible").click()),this._index.node=0,n("#"+this._id).find(".hoverCell").removeClass("hoverCell"),t.isNullOrUndefined(this._curFocus.tree)?t.isNullOrUndefined(this._curFocus.button)?t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)||this.model.pivotControl._curFocus.tab.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"):this._curFocus.button.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"):this._curFocus.tree.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"))},_getLocalizedLabels:function(n){return t.PivotSchemaDesigner.Locale[this.locale()][n]===i?t.PivotSchemaDesigner.Locale["en-US"][n]:t.PivotSchemaDesigner.Locale[this.locale()][n]},_setTableFields:function(n){t.isNullOrUndefined(n)||(this.model.pivotTableFields=n)},_setPivotRows:function(n){t.isNullOrUndefined(n)||(this.model.pivotRows=n)},_setPivotColumns:function(n){t.isNullOrUndefined(n)||(this.model.pivotColumns=n)},_setPivotCalculations:function(n){t.isNullOrUndefined(n)||(this.model.pivotCalculations=n)},_setFilters:function(n){t.isNullOrUndefined(n)||(this.model.filters=n)},_getSortedHeaders:function(){for(var i=this.element.find(".descending").parents("label"),r="",t=0;t<i.length;t++)r+=n(i[t]).attr("for").replace("toggleBtn","")+"##";return r},_contextOpen:function(i){var u,r;if(n(i.target.parentElement).find(".measureGroupCDB").length>0||n(i.target.parentElement).find(".folderCDB").length>0||!(this.element.parents(".e-pivotclient").length>0)&&n(i.target.parentElement).find(".dimensionCDB").length>0||!n(i.target).hasClass("e-text"))return!1;t.Pivot.openPreventPanel(this);this._selectedMember=n(i.target);this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(r=n("#pivotTreeContext").data("ejMenu"),n(i.target).parents("li:eq(0)").attr("tag").toLowerCase().indexOf("[measures]")>=0?(r.disableItem(this._getLocalizedLabels("AddToFilter")),r.disableItem(this._getLocalizedLabels("AddToRow")),r.disableItem(this._getLocalizedLabels("AddToColumn")),r.enableItem(this._getLocalizedLabels("AddToValues"))):(r.disableItem(this._getLocalizedLabels("AddToValues")),n(i.target.parentElement).find(".namedSetCDB").length>0?r.disableItem(this._getLocalizedLabels("AddToFilter")):r.enableItem(this._getLocalizedLabels("AddToFilter")),r.enableItem(this._getLocalizedLabels("AddToRow")),r.enableItem(this._getLocalizedLabels("AddToColumn")))):this._dataModel=="Pivot"&&(u=i.target.textContent,n(i.target).hasClass("e-text")&&(n(this.element).parents(".e-pivotclient").length>0||n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==u}).length==0)?(r=n("#pivotTreeContext").data("ejMenu"),r.enable()):(r=n("#pivotTreeContext").data("ejMenu"),r.disable()))},_nodeDrag:function(i){return this._isDragging=!0,(n(i.dragTarget.parentElement).find(".measureGroupCDB").length>0||n(i.dragTarget.parentElement).find(".folderCDB").length>0||n(i.dragTarget.parentElement).find(".dimensionCDB").length>0)&&!(n(i.dragTarget.parentElement).find(".dimensionCDB").length>0&&this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne)?!1:void 0},_treeContextClick:function(i){var r,u,f;schemaObj=this;r=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null;t.isNullOrUndefined(this._curFocus.tree)?t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)||this.model.pivotControl._curFocus.tab.attr("tabindex","-1").focus().addClass("hoverCell"):this._curFocus.tree.attr("tabindex","-1").focus().addClass("hoverCell");u=i.text==this._getLocalizedLabels("AddToColumn")?this.element.find(".schemaColumn"):i.text==this._getLocalizedLabels("AddToRow")?this.element.find(".schemaRow"):i.text==this._getLocalizedLabels("AddToValues")?this.element.find(".schemaValue"):i.text==this._getLocalizedLabels("AddToFilter")?this.element.find(".schemaFilter"):"";f={dropTarget:u,droppedElement:this._selectedMember.parent().parent(),target:u};t.isNullOrUndefined(r)?this.model.pivotControl._waitingPopup.show():(r._isTimeOut=!0,setTimeout(function(){r._isTimeOut&&schemaObj.model.pivotControl._waitingPopup.show()},800));this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._nodeDropped(f):this._clientOnNodeDropped(f)},_checkedChange:function(t){var i=n(t.event.target).parents(".e-pivotschemadesigner").data("ejPivotSchemaDesigner"),r=n(".btnDeferUpdate").data("ejButton");t.isChecked?(i.model.pivotControl.model.enableDeferUpdate=!0,r.enable()):(i.model.pivotControl.model.enableDeferUpdate=!1,i.model.pivotControl._isUpdateRequired&&i.model.pivotControl._deferUpdate(),r.disable())},_sortBtnClick:function(i){var r;if(n(i.target).toggleClass("descending"),this.model.pivotControl._dataModel!="Olap"&&this.model.pivotControl._dataModel!="XMLA")if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){t.PivotAnalysis._valueSorting=null;var f=n(i.target).parents(".pivotButton").attr("tag").split(":")[1],e=this.model.pivotControl.model.dataSource[n(i.target).parents(".pivotButton").attr("tag").split(":")[0].toLowerCase()],u=n.grep(e,function(n){return n.fieldName==f}),o=i.target.className.indexOf("descending")>=0?t.PivotAnalysis.SortOrder.Descending:t.PivotAnalysis.SortOrder.Ascending;for(r=0;r<u.length;r++)u[r].sortOrder=o;this.model.pivotControl._populatePivotGrid()}else this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.model.pivotControl._sortBtnClick(i)},_generateMembers:function(r,u){var o=n(u).find("Axis:eq(0) Tuple"),e=[],l={},f,s,a,h,c;for(e.push({id:"All",name:"All",checkedStatus:!0,tag:""}),f=0;f<o.length;f++)s=n(n(u).find("Axis:eq(0) Tuple:eq("+f+")").children().children()[0]).text(),a=n(n(u).find("Axis:eq(0) Tuple:eq("+f+")").children().children()[1]).text()==""?"(Blank)":n(n(u).find("Axis:eq(0) Tuple:eq("+f+")").children().children()[1]).text(),l={hasChildren:n(o[f]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!0,id:s.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:a,tag:s,level:parseInt(n(o[f]).find("LNum").text())},e.push(l);t.isNullOrUndefined(this._waitingPopup)||(h=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,t.isNullOrUndefined(h)||(h._isTimeOut=!1),this._waitingPopup.hide());!t.isNullOrUndefined(this.model.pivotControl)&&this.model.pivotControl.model.enableMemberEditorPaging?(this._editorTreeData=e,this._editorTreeData.splice(0,1),this._memberCount=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",null||i)).length,this.model.pivotControl._currentReportItems.push({filterItems:this._editorTreeData,fieldName:this._selectedFieldName,dataSrc:this.model.pivotControl.model.dataSource,pageSettings:this._memberCount}),c=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",null||i).page(this._memberPageSettings.currentMemeberPage,this.model.pivotControl.model.memberEditorPageSize)),c.splice(0,0,{id:"All",name:"All",checkedStatus:this._isAllMemberChecked,tag:""}),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(c)})):this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(e)})},_generateChildMembers:function(t,i){for(var f=n(i).find("Axis:eq(0) Tuple"),e=[],r=this.element.find("[tag='"+t.currentNode.replace(/&amp;/g,"&")+"']"),u=0;u<f.length;u++){var o=n(n(i).find("Axis:eq(0) Tuple:eq("+u+")").children().children()[0]).text(),s=n(n(i).find("Axis:eq(0) Tuple:eq("+u+")").children()).find("Caption").text(),h={hasChildren:n(f[u]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!1,id:o.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:s,tag:o,level:n(f[u]).find("LNum").text()};e.push(h)}parentNode=n(r).parents("li").length>1?n(r).parents("li").first():n(r).parents("li");r.find(".e-load").removeClass("e-load");n(n(parentNode).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});n.each(r.find("li"),function(n,t){t.setAttribute("tag",e[n].tag)});this._memberTreeObj=n(".editorTreeView").data("ejTreeView");this._memberTreeObj.addNode(e,n(r))},_sortField:function(i){if(t.Pivot.closePreventPanel(this),this.element.find(".e-dialog, .clientDialog").remove(),n(i.element).attr("id")=="descOrder"||n(i.element).attr("id")=="ascOrder"){var r=t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource).item;t.isNullOrUndefined(r)||(r.sortOrder=n(i.element).attr("id")=="descOrder"?t.olap.SortOrder.Descending:t.olap.SortOrder.Ascending);this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this.model.pivotControl.refreshControl():(t.olap.base._clearDrilledCellSet(),t.olap.base.getJSONData({action:"sorting"},this.model.pivotControl.model.dataSource,this.model.pivotControl))}},_clientOnFilterBtnClick:function(r){var s,f,e,u;if(t.Pivot.openPreventPanel(this),s=this,this._isAllMemberChecked=!0,f=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,t.isNullOrUndefined(f)?this._waitingPopup.show():(f._isTimeOut=!0,setTimeout(function(){f._isTimeOut&&s._waitingPopup.show()},800)),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap){if(n(r.target).parents().hasClass("pivotButton")&&n(r.target).parents(".pivotButton").attr("tag").indexOf(":[")>=0&&!(n(r.target).parents(".pivotButton").attr("tag").toLowerCase().indexOf("[measures]")>=0))this._selectedFieldName=n(r.target).parents(".pivotButton").attr("tag").split(":")[1];else{if(n(r.target).parents().attr("tag")!=null&&(n(r.target).parents().attr("tag").split(":")[1]=="Measures"||n(r.target).parent().attr("tag").toLowerCase().indexOf("[measures]")>=0))return t.Pivot.closePreventPanel(this),t.isNullOrUndefined(f)||(f._isTimeOut=!1),!1;this._selectedLevel=n(n(r.target).parents("li:eq(0)")).attr("tag");this._selectedFieldName=n(r.target).parents("li:eq(0)").children("div:eq(0)").find(".levels").length>0?n(n(r.target).parents("li:eq(1)")).attr("tag"):n(n(r.target).parents("li:eq(0)")).attr("tag")}if(t.isNullOrUndefined(this._selectedFieldName)||this._selectedFieldName.toLocaleLowerCase().indexOf("measures")>=0)return!1;var c=this._selectedFieldName,h=this.model.pivotControl.model.dataSource,o,u=n.map(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName==c&&(t.isNullOrUndefined(n.dataSrc)||n.dataSrc.cube==h.cube&&n.dataSrc.reportName==h.reportName))return o=n.pageSettings,n.filterItems});this.model.pivotControl.model.enableMemberEditorPaging&&(o&&(this._memberCount=o),this._memberPageSettings.endPage=this.model.pivotControl.model.memberEditorPageSize,this._memberPageSettings.startPage=0,this._memberPageSettings.currentMemeberPage=1);u.length>0?(this.model.pivotControl.model.enableMemberEditorPaging&&(this._editorTreeData=u,this._memberCount=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",null||i)).length,u=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",null||i).page(this._memberPageSettings.currentMemeberPage,this.model.pivotControl.model.memberEditorPageSize)),u.splice(0,0,{id:"All",name:"All",checkedStatus:this._isAllMemberChecked,tag:""})),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(u)})):t.olap._mdxParser.getMembers(this.model.pivotControl.model.dataSource,this._selectedFieldName,this)}else this._selectedFieldName=n(r.target).parent().hasClass("pivotButton")&&n(r.target).parent().attr("tag").indexOf(":")>=0?n.grep(this.model.pivotTableFields,function(t){return t.name==n(r.target).parent().attr("tag").split(":")[1]})[0].name:n.grep(this.model.pivotTableFields,function(t){return t.id==n(n(r.target).closest("li")).attr("id")})[0].name;e=n(this.element.find(".pivotButton button[fieldname='"+this._selectedFieldName+"']"));this._dialogHead=this._selectedFieldCaption=e.attr("fieldCaption");this._selectedFieldAxis=e.parents().hasClass("schemaRow")?"rows":e.parents().hasClass("schemaColumn")?"columns":e.parents().hasClass("schemaValue")?"values":"filters";this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(this.model.pivotControl.model.enableMemberEditorPaging?(this._memberPageSettings.endPage=this.model.pivotControl.model.memberEditorPageSize,this._memberPageSettings.startPage=0,this._memberPageSettings.currentMemeberPage=1,u=this._getTreeViewData(),u.splice(0,1),this._editorTreeData=u,this._memberCount=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",null||i)).length,u=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",null||i).page(this._memberPageSettings.currentMemeberPage,this.model.pivotControl.model.memberEditorPageSize)),u.splice(0,0,{id:"All",name:"All",checkedStatus:this._isAllMemberChecked,tag:""}),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(u)})):this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(this._getTreeViewData())}))},_getTreeViewData:function(){var s=this.model.pivotControl.model.dataSource[this._selectedFieldAxis],o=this._selectedFieldName,f=n.grep(s,function(n){return n.fieldName==o})[0],u=t.PivotAnalysis.getMembers(o),e=[{id:"All",name:"All",checkedStatus:!0}],r;if(f.filterItems!=null&&f.filterItems!=i)for(r=0;r<u.length;r++)e.push({id:u[r],name:u[r],checkedStatus:f.filterItems.filterType==t.PivotAnalysis.FilterType.Include?n.inArray(u[r].toString(),f.filterItems.values)>=0:n.inArray(u[r].toString(),f.filterItems.values)<0});else for(r=0;r<u.length;r++)e.push({id:u[r],name:u[r],checkedStatus:!0});return e},_filterBtnClick:function(i){var v,s,e,h,y,l,p,c,u,r,o,f,a,b,w;if(this.model.pivotControl._editorFlag=!1,this._isAllMemberChecked=!0,t.Pivot.openPreventPanel(this),v=this,s=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){for(this.model.pivotControl._dataModel=="XMLA"?n(i.target).parents("li:eq(0)").length>0?(this._selectedLevel=n(n(i.target).parents("li:eq(0)")).attr("tag"),e=n(i.target).parents("li:eq(0)").children("div:eq(0)").find(".levels").length>0?n(n(i.target).parents("li:eq(1)")).attr("tag"):n(n(i.target).parents("li:eq(0)")).attr("tag")):(this._selectedLevel=n(i.target).parent().attr("tag").split(":")[1],e=n(i.target).parent().attr("tag").split(":")[1]):e=n.grep(this.model.pivotTableFields,function(t){return t.caption==n(n(i.target).parent()).text()})[0].name,r=0;r<this.element.find(".pivotButton").length;r++)if(uniqueName=n(this.element.find(".pivotButton")[r]).find("button").attr("fieldName"),uniqueName==e){h=n(this.element.find(".pivotButton")[r]).find("button").text();this._selectedAxis=n(this.element.find(".pivotButton")[r]).parent()[0].className.split(" ")[0];break}this._selectedAxis=this.model.pivotControl._selectedAxis=this._selectedAxis=="schemaRow"?"rows":this._selectedAxis=="schemaColumn"?"columns":this._selectedAxis=="schemaValue"?"values":"filters";this._dialogTitle=this.model.pivotControl._dialogTitle=h;this._dialogHead=this.model.pivotControl._dialogHead=h;this._selectedMember=this.model.pivotControl._selectedField=e;this.model.pivotControl._dataModel=="XMLA"?(y=n(i.target).parents("li:eq(0)").length>0?n(i.currentTarget).parents("li:eq(0)").attr("tag"):n(i.target).parent().attr("tag").split(":")[1],l=n.map(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName==y)return n.filterItems}),l.length>0?this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(l)}):this._selectedMember=e):(p=this.model.pivotControl._getTreeViewData(e,h,this._selectedAxis),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(p)}))}else{if(n(this._tableTreeObj.element).find("span.e-icon.treeDrop").css({display:"none"}),this._dataModel=="Olap"){if(n(i.target).attr("class").indexOf("filter")>-1){for(r=0;r<this.model.pivotTableFields.length;r++)(this.model.pivotTableFields[r].tag.replace(/\[/g,"").replace(/\]/g,"").indexOf("Measures")>-1&&this.model.pivotTableFields[r].isSelected==!0||this.model.pivotTableFields[r].isSelected==!0&&n(i.target.parentElement).attr("tag").split(":")[1]==this.model.pivotTableFields[r].tag.replace(/\[/g,"").replace(/\]/g,""))&&(c=this.model.pivotTableFields[r].spriteCssClass);for(o=0;o<this._tableTreeObj.element.find("li").length;o++)n(n(i.target).parent()).attr("tag").split(":")[1]==n(this._tableTreeObj.element.find("li")[o]).attr("tag").replace(/\]/g,"").replace(/\[/g,"")&&(u=n(this._tableTreeObj.element.find("li")[o]))}else c=n(i.target).parent().find("a>span").attr("class");n(i.target).attr("class").indexOf("filter")>-1||(u=c.indexOf("hierarchyCDB")>-1||c.indexOf("attributeCDB")>-1?n(i.target).parents("li")[0]:n(i.target).parents("li")[1])}else u=n(i.target).attr("class").indexOf("filter")>-1?this._tableTreeObj.element.find("li:contains('"+n(n(i.target).parent()).attr("tag").split(":")[1]+"')"):n(n(i.target).parent()).parent();if(this._selectedTreeNode=u,i.target.tagName.toLowerCase()=="span"||i.target.tagName.toLowerCase()=="button"){if(this._curFilteredText=this.model.layout!="excel"&&n(i.target).attr("class").indexOf("filter")>-1?n(n(i.target).parents(".pivotButton")).attr("tag").split(":")[1].replace(/\]/g,"").replace(/\[/g,""):this._dataModel=="Olap"?n(u).attr("tag").replace(/\]/g,"").replace(/\[/g,""):n(u).attr("id"),n(this.element).parents(".e-pivotclient").length>0&&(this._curFilteredText=n(n(i.target).parents(".pivotButton")).attr("tag").split(":")[1].replace(/\]/g,"").replace(/\[/g,"")),n(i.target).parents("li:eq(1)").find("div:first>a>span").hasClass("hierarchyCDB")&&(this._curFilteredText=n(i.target).parents("li:eq(1)").find("div:first>a").text()),this._dataModel=="Pivot"&&(n(this.element).parents(".e-pivotclient").length>0?(this._curFilteredAxis=n(u)[0].className.split(" ")[0],this.model.pivotControl._curFilteredText=this._curFilteredText):this._curFilteredAxis=t.isNullOrUndefined(this.element.find(".e-btn:contains('"+(n(this.element).parents(".e-pivotclient").length>0?n(u).text():n(u).find("div:first").text())+"')").parents(".e-droppable")[0])?"":this.element.find(".e-btn:contains('"+n(u).find("div:first").text()+"')").parents(".e-droppable")[0].className.split(" ")[0],this._dialogHead=n(i.target).attr("fieldcaption")||this._curFilteredText),this._dialogTitle=this._dataModel=="Olap"?n(this.element.find(".pivotButton:contains('"+n(u).find("div:first").text()+"')")[0]).attr("tag"):n(i.target).parents("li").length>0?n(i.target).parents("li").attr("id")||i.target.id.replace("filterBtn","")||n(i.target).parents(".filterBtn")[0].id.replace("filterBtn",""):n(i.target).parent().attr("tag").split(":")[1]||i.target.id.replace("filterBtn","")||n(i.target).parents(".filterBtn")[0].id.replace("filterBtn",""),n(this.element).parents(".e-pivotclient").length>0&&n(u)[0].className.split(" ")[0]=="schemaFilter"&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&(this._dialogTitle=this._curFilteredText),this._dataModel=="Olap")for(f=0;f<this.element.find(".e-btn").length;f++)if(!t.isNullOrUndefined(n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).attr("tag"))&&n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).attr("tag").split(":")[1]==n(this._selectedTreeNode).attr("tag").replace(/\]/g,"").replace(/\[/g,"")&&n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).attr("tag").indexOf(this._curFilteredText)>-1){this._curFilteredAxis=t.isNullOrUndefined(n(n(this.element.find(".e-btn"))[0]).parents(".e-droppable")[0])?"":n(n(this.element.find(".e-btn"))[0]).parents(".e-droppable")[0].className.split(" ")[0];this._dialogTitle=n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).attr("tag");this._dialogHead=n(n(n(this.element.find(".e-btn"))[f])[0]).attr("fieldCaption");break}try{a=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(k){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(a=this.model.pivotControl.getOlapReport())}b=this._getSortedHeaders();this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.pivotControl.model.customObject});w=JSON.stringify({action:"fetchMembers",headerTag:this._dialogTitle+(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.enableAdvancedFilter?"##true":"")||"UniqueName##"+n(u).attr("tag"),sortedHeaders:this.model.pivotControl._ascdes,currentReport:a,valueSorting:JSON.stringify(this.model.pivotControl.model.valueSortSettings),customObject:JSON.stringify(this.model.pivotControl.model.customObject)});t.isNullOrUndefined(s)?this.model.pivotControl._waitingPopup.show():(s._isTimeOut=!0,setTimeout(function(){s._isTimeOut&&v.model.pivotControl._waitingPopup.show()},800));this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.fetchMembers,w,this.model.pivotControl.model.enableMemberEditorPaging?t.Pivot._fetchMemberPageSuccess:this._fetchMemberSuccess)}}},_removeBtnClick:function(i){var r,s,f,l,h,u,e,c,o;if(schemaObj=this,r=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,t.isNullOrUndefined(r)?this.model.pivotControl._waitingPopup.show():(r._isTimeOut=!0,setTimeout(function(){r._isTimeOut&&schemaObj.model.pivotControl._waitingPopup.show()},800)),this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode)t.PivotAnalysis._valueSorting=null,s=n(i.target).parent().attr("tag").split(":")[1],t.Pivot.removeReportItem(this.model.pivotControl.model.dataSource,s,s.toLocaleLowerCase().indexOf("measures")==0),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.pivotControl._fieldMembers={},this.model.pivotControl._fieldSelectedMembers={},t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"},this.model.pivotControl)),this.model.pivotControl.element.hasClass("e-pivotclient")&&this.model.pivotControl._pivotChart&&(this.model.pivotControl._pivotChart._labelCurrentTags={}),this._refreshPivotButtons(),this.model.pivotControl.refreshControl(),n(i.target).parent().remove();else{for(f=n(i.target.parentElement).find("button").attr("fieldname")||n(i.target.parentElement).text(),h=n(n(this._tableTreeObj.element).find("div:contains("+f+")>span")[1]).find(".e-chk-act"),n(h).removeClass("e-chk-act").addClass("e-chk-inact"),n(h).children("e-checkmark").removeClass("e-checkmark"),u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].id==f&&(this.model.pivotTableFields[u].IsSelected=!1,l=this.model.pivotTableFields[u]);if(n(i.target.parentElement).remove(),n(this.element).parents(".e-pivotclient").length>0&&(e=n(i.target).parent().attr("tag"),delete this.model.pivotControl._fieldMembers[e.split(":")[e.split(":").length-1]],delete this.model.pivotControl._fieldSelectedMembers[e.split(":")[e.split(":").length-1]]),this._clearFilterData(f),this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.pivotControl.model.customObject}),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&n(this.element).parents(".e-pivotclient").length>0){try{c=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(a){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(c=this.model.pivotControl.getOlapReport())}o=JSON.stringify({action:"removeButton",args:JSON.stringify({headerTag:f,currentReport:c,sortedHeaders:t.isNullOrUndefined(this.model.pivotControl._ascdes)?"":this.model.pivotControl._ascdes}),customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,o,this._droppedSuccess)}else o=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(l),sortedHeaders:this._getSortedHeaders(),currentReport:this.model.pivotControl.getOlapReport(),customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,o,this._nodeStateModifiedSuccess)}t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||t.isNullOrUndefined(r)||(r._isTimeOut=!1)},_nodeCheckChanges:function(r){var f,o,u,e;if(this._isFiltered=!0,(r.id.toLowerCase()=="(all)_0"||r.id.toLowerCase()=="all")&&r.type=="nodeUncheck"){if(this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("unCheckAll"),this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this),this._dialogOKBtnObj.disable(),this.model.pivotControl&&this.model.pivotControl.model.enableMemberEditorPaging)for(this.element.find(".dialogOKBtn").attr("disabled","disabled"),this._isAllMemberChecked=!1,f=0;f<this._editorTreeData.length;f++)this._editorTreeData[f].checkedStatus=!1}else if((r.id.toLowerCase()=="(all)_0"||r.id.toLowerCase()=="all")&&r.type=="nodeCheck"){if(this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("checkAll"),n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-stop"),this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this),this._dialogOKBtnObj.enable(),this.model.pivotControl&&this.model.pivotControl.model.enableMemberEditorPaging)for(this.element.find(".dialogOKBtn").removeAttr("disabled"),this._isAllMemberChecked=!0,f=0;f<this._editorTreeData.length;f++)this._editorTreeData[f].checkedStatus=!0}else(r.id.toLowerCase()=="(all)_0"||r.id.toLowerCase()!="all")&&!t.isNullOrUndefined(this.model.pivotControl)&&this.model.pivotControl.model.enableMemberEditorPaging?r.type=="nodeUncheck"?(this.model.pivotControl._isMembersFiltered=!0,o="",t.Pivot._memberPageNodeUncheck(r,this),o=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",null||i).where("checkedStatus","equal",!0)),e=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)"),t.isNullOrUndefined(o)||o.length!=0?n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-stop").addClass("e-checkmark"):(this._dialogOKBtnObj.disable(),this.element.find(".dialogOKBtn").attr("disabled","disabled"),this._isAllMemberChecked=!1,e.removeClass("e-stop").removeClass("e-checkmark").addClass("e-chk-inact"))):r.type=="nodeCheck"&&(this.model.pivotControl._isMembersFiltered=!0,t.Pivot._memberPageNodeCheck(r,this),this.element.find(".dialogOKBtn").data("ejButton").enable(),this.element.find(".dialogOKBtn").removeAttr("disabled"),this._isAllMemberChecked=!0,n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-stop").addClass("e-checkmark")):(r.id.toLowerCase()=="(all)_0"||r.id.toLowerCase()!="all")&&(u=this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),e=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)"),u.length==0||u.length==1&&u[0].id[u[0].id.length-1]==0?(n(e).parent().removeClass("e-chk-inact").removeClass("e-chk-ind").addClass("e-chk-act"),e.removeClass("e-stop").addClass("e-checkmark")):r.type=="nodeCheck"&&u.length==1&&u[0].id[u[0].id.length-1]==0?e.removeClass("e-stop").addClass("e-checkmark"):u.length>0&&e.removeClass("e-checkmark").addClass("e-stop"),this._dialogOKBtnObj.enable(),r.type=="nodeUncheck"&&u.length+1==this._memberTreeObj.element.find("li").length&&(e.removeClass("e-checkmark").removeClass("e-stop"),this._dialogOKBtnObj.disable()))},_pivotCheckedStateModified:function(r){var f,p,a,w,v,u;if(this._nodeCheck==!0)return this._nodeCheck=!1,!1;if(this._isDropAction)return!1;t.PivotAnalysis._valueSorting=null;var e=this.model.pivotControl._dataModel=="XMLA"?n(r.currentElement).attr("tag"):this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n.grep(this.model.pivotTableFields,function(t){return t.caption==n(r.currentElement).find("a")[0].textContent})[0].name:n(r.currentElement).find("a")[0].textContent,s=n(r.currentElement).find("a")[0].textContent,h="",c="",y="",l="",o=this.model.pivotControl._dataModel=="XMLA"?"XMLA":"",h=[];for(u=0;u<this.element.find(".pivotButton").length;u++)if(y=n(this.element.find(".pivotButton")[u]).find("button").attr("fieldName"),y==e&&(h.push(this.element.find(".pivotButton")[u]),o=="XMLA"))break;for(u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].name==e&&r.type=="nodeCheck"?(this.model.pivotTableFields[u].isSelected=!0,c=this.model.pivotTableFields[u]):this.model.pivotTableFields[u].name==e&&r.type=="nodeUncheck"&&(this.model.pivotTableFields[u].isSelected=!1,c=this.model.pivotTableFields[u]);if(r.type=="nodeUncheck")if(h.length>1)for(u=0;u<h.length;u++)n(h[u]).find("button").attr("fieldName")==e&&n(h[u]).remove();else n(h).remove();try{l=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(b){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(l=this.model.pivotControl.getOlapReport())}if(o=="XMLA"&&l==""&&(l=this.model.pivotControl.model.dataSource,this._selectedMember=e,this._selectedTreeNode=n(r.currentElement),this.model.pivotControl.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeStateModefied"})),f=this._droppedClass!=""?this._droppedClass:c.pivotType!=i?c.pivotType=="PivotItem"?"schemaRow":"schemaValue":"schemaRow",this._droppedClass="",r.type=="nodeCheck"){if(o=="XMLA"?(s=n(r.currentElement).find(".kpi").length>0?n(r.currentElement).parents("li:eq(0)").children("div").text()+" "+s:s,p=this.model.pivotControl.model.dataSource.enableAdvancedFilter?n(r.currentElement.find(".e-text")):n(r.currentElement.find(".e-text")[0]),n(r.currentElement).attr("tag").toLowerCase().indexOf("[measures]")<0&&!(n(r.currentElement).find(".namedSetCDB").length>0)?p.after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML):"",n(r.currentElement).attr("tag").toLocaleLowerCase().indexOf("[measures]")>=0&&(f="schemaValue"),droppedItem=n(r.currentElement).find(".namedSetCDB").length>0?{fieldName:n(r.currentElement).attr("tag"),fieldCaption:n(r.currentElement).text(),isNamedSets:!0}:t.olap.base._getCaption({fieldName:e,fieldCaption:s},this.model.pivotControl._fieldData.hierarchy)):(n(r.currentElement.find(".e-text")[0]).after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML),droppedItem={fieldName:e,fieldCaption:s}),f=f==""?"row":f=="schemaColumn"?"column":f=="schemaRow"?"row":f=="schemaValue"?"value":f=="schemaFilter"?"filter":"",this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(a=n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==e}),a.length>0)){if(this._calculatedFieldItems(a))return;f="value";droppedItem={fieldName:e,fieldCaption:s,isCalculatedField:!0,formula:a[0].formula}}this._createPivotButton(droppedItem,f,"","","");o=="XMLA"&&f=="value"?(this.model.pivotControl.model.dataSource.values.length==0&&this.model.pivotControl.model.dataSource.values.push({measures:[],axis:"columns"}),measuresAxis=this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns:":"Rows:",this.element.find("div[tag='"+measuresAxis+"Measures']").length==0&&this._createPivotButton({fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")},measuresAxis=="Columns:"?"column":"row","","",""),this.model.pivotControl.model.dataSource.values[0].measures.push(droppedItem)):n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.fieldName==droppedItem.fieldName}).length==0&&(f=="row"?this.model.pivotControl.model.dataSource.rows.push(droppedItem):f=="column"?this.model.pivotControl.model.dataSource.columns.push(droppedItem):f=="filter"?this.model.pivotControl.model.dataSource.filters.push(droppedItem):this.model.pivotControl.model.dataSource.values.push(droppedItem));o=="XMLA"?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeCheck"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(this._trigger("fieldItemDropped",{axis:f,fieldItem:r.currentElement}),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}else if(r.type=="nodeUncheck"){if(n(r.currentElement).removeClass("filter").find(".filter").remove(),n(r.currentElement).removeClass("filter").find(".treeDrop").remove(),this.model.pivotControl.model.dataSource.columns=n.grep(this.model.pivotControl.model.dataSource.columns,function(n){return n.fieldName!=e}),this.model.pivotControl.model.dataSource.rows=n.grep(this.model.pivotControl.model.dataSource.rows,function(n){return n.fieldName!=e}),w=this.model.pivotControl.model.dataSource.values,o=="XMLA")t.olap._mdxParser._getItemPosition(this.model.pivotControl.model.dataSource.values[0].measures,e).length>0&&this.model.pivotControl.model.dataSource.values[0].measures.splice(t.olap._mdxParser._getItemPosition(this.model.pivotControl.model.dataSource.values[0].measures,e)[0],1),this.model.pivotControl.model.dataSource.values[0].measures.length==0&&this.element.find("div[tag='"+(this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns":"Rows")+":Measures']").remove();else if(this.model.pivotControl.model.dataSource.values=n.grep(w,function(n){return n.fieldName!=e}),this.model.pivotControl._calculatedField.length>0)for(v=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.isCalculatedField==!0&&n.formula.indexOf(e)>-1}),u=0;u<v.length;u++)this._tableTreeObj.uncheckNode(v[u].fieldName);this.model.pivotControl.model.dataSource.filters=n.grep(this.model.pivotControl.model.dataSource.filters,function(n){return n.fieldName!=e});o=="XMLA"?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeUncheck"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(f=f==""?"row":f=="schemaColumn"?"column":f=="schemaRow"?"row":f=="schemaValue"?"value":f=="schemaFilter"?"filter":"",this._trigger("fieldItemDropped",{axis:f,fieldItem:r.currentElement}),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}this._setPivotBtnWidth()},_calculatedFieldItems:function(i){var u,r;if(i.length>0)for(u=i[0].formula.replace(/\(|\)/g," ").replace(/[-+*/^%]/g," ").split(" "),r=0;r<u.length;r++)if(!n.isNumeric(u[r])&&u[r].replace(/\s+|\s+$/gm,"")!=""&&(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.fieldName==u[r]}).length==0||this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&n.grep(JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,function(n){return n.FieldName==u[r]}).length==0))return alert(this.model.pivotControl._getLocalizedLabels("NotPresent")),this._tableTreeObj.model.nodeCheck=null,this._tableTreeObj.model.nodeUncheck=null,this._tableTreeObj.uncheckNode(i[0].name),this._tableTreeObj.model.nodeCheck=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.proxy(this._checkedStateModified,this):t.proxy(this._pivotCheckedStateModified,this),this._tableTreeObj.model.nodeUncheck=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.proxy(this._checkedStateModified,this):t.proxy(this._pivotCheckedStateModified,this),!0;return!1},_checkedStateModified:function(i){var nt,b,k,v,h,l,y,p,r,e,f,d,tt,w,u;if(this.model.pivotControl._isUpdateRequired=!0,this._isMeasureBtnRemove==!0)return this._isMeasureBtnRemove=!1,!1;if(this._nodeCheck==!0)return this._nodeCheck=!1,!1;var s=n(i.currentElement).find("a")[0].textContent,a="",g="",o="",r="",c="";if(this._dataModel!="Pivot"||i.type!="nodeCheck"||(nt=n.grep(this.model.pivotControl._calculatedField,function(t){return t.name==n(i.currentElement).attr("id")}),!this._calculatedFieldItems(nt))){if(this._dataModel=="Olap")if(!i.currentElement[0].id.indexOf("[Measures]")>-1){for(u=0;u<this.element.find(".pivotButton").length;u++)if(r=n(this.element.find(".pivotButton")[u]).attr("tag"),c="",c=r.indexOf("[Measures]")>-1||r.indexOf("[")>-1?r.split(":")[1]:this.model.pivotControl._getNodeUniqueName(r),c=c.replace("<>","."),n(i.currentElement).attr("tag").toLowerCase()==c.toLowerCase()){o=n(this.element.find(".pivotButton")[u]);break}}else o=this.element.find(".pivotButton:contains("+s+")"),r,e;else o=this.element.find(".pivotButton:contains("+s+")"),r,e;for(b=o.length>0&&n(o).siblings(".filterIndicator").length>0?!0:!1,k=i.currentElement.find("~ span:eq(0) span.descending").length>0?!0:!1,u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].name==s&&i.type=="nodeCheck"?(this.model.pivotTableFields[u].isSelected=!0,r=this.model.pivotTableFields[u]):this.model.pivotTableFields[u].name==s&&i.type=="nodeUncheck"&&(this.model.pivotTableFields[u].isSelected=!1,r=this.model.pivotTableFields[u]);if(t.isNullOrUndefined(r)&&(r=n(i.currentElement).attr("tag")),i.type=="nodeUncheck")if(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this._clearFilterData(s),o.length>1)for(u=0;u<o.length;u++)n(o[u]).text()==s&&n(o[u]).remove();else n(o).remove();else this._droppedClass!=""?this._createPivotButton({fieldName:r.id,fieldCaption:s},this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaValue"?"value":this._droppedClass=="schemaFilter"?"filter":"",b,k,""):this._createPivotButton({fieldName:r.id,fieldCaption:s},this._dataModel=="Olap"&&n(i.currentElement).attr("tag").indexOf("[Measures]")<0||this._dataModel=="Pivot"&&r.pivotType=="PivotItem"?"row":"value",b,k,"");if(!t.isNullOrUndefined(this._tempFilterData))for(u=0;u<this._tempFilterData.length;u++)if(!t.isNullOrUndefined(this._tempFilterData[u][r.id]))for(v=0;v<this._tempFilterData[u][r.id].length;v++)g+="##"+this._tempFilterData[u][r.id][v];try{e=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(it){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(e=this.model.pivotControl.getOlapReport())}if(a="schemaRow::"+s+"::FILTERED"+g,h=this._droppedClass!=""?this._droppedClass:r.pivotType=="PivotItem"?"schemaRow":"schemaValue",this._droppedClass="",t.isNullOrUndefined(this.model.pivotControl)||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),i.type=="nodeCheck"||i.type=="nodeUncheck"||h==""){if(i.type=="nodeCheck")this._dataModel=="Olap"?(n(i.currentElement).attr("tag").indexOf("[Measures]")==-1&&(p=t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filter button").addClass("treeDrop")[0].outerHTML,n(i.currentElement.find(".e-text")[0]).after(n(p).hide())),this._nodeDropedParams=h=="schemaColumn"?"Categorical":h=="schemaRow"?"Series":h=="schemaFilter"?"Slicer":"",r=n(i.currentElement).attr("tag"),l=this._nodeDropedParams==""?n(i.currentElement).attr("tag").indexOf("[Measures]")>=0?"Categorical":"Series":this._nodeDropedParams,r.toLowerCase().indexOf("[measures]")>-1&&(l="Categorical"),y=this._currentCubeName+"--"+r+"--"+l+"--",e,this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:y,currentReport:e,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._droppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._droppedSuccess)):(n(i.currentElement.find(".e-text")[0]).after(n(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filter button").addClass("treeDrop")[0].outerHTML).hide()),this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(r),dropAxis:h+"::",sortedHeaders:this.model.pivotControl._ascdes,filterParams:a,currentReport:e,valueSorting:JSON.stringify(this.model.pivotControl.model.valueSortSettings),customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess));else if(i.type=="nodeUncheck")if(this._dataModel=="Olap"){if(n(i.currentElement.find(".treeDrop")).remove(),n(i.currentElement).find(".filter").removeClass("filter"),r=n(o).attr("tag"),delete this.model.pivotControl._fieldMembers[r.split(":")[r.split(":").length-1]],delete this.model.pivotControl._fieldSelectedMembers[r.split(":")[r.split(":").length-1]],this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"removeButton",headerInfo:r,currentReport:e,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),t.isNullOrUndefined(r))return!1;(r.indexOf("[Measures]")>=0||r.toLowerCase().indexOf("[measures]"))&&this.element.find(".schemaValue .pivotButton").length==0?(d=r.split(":"),tt=d[0]=="Rows"?".schemaRow":d[0]=="Columns"?".schemaColumn":"",this.element.find(tt+" .pivotButton:contains('Measures')").remove()):r.indexOf("[Measures]")<0&&r.indexOf("Measures")>=0&&this.element.find(".schemaValue .pivotButton").remove();this.model.pivotControl.model.enableDeferUpdate?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,f.replace("removeButton","removeButtonDeferUpdate"),this._droppedSuccess)):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,f,this._pvtBtnDroppedSuccess)}else{if(this._clearFilterData(r.id),this.model.pivotControl._calculatedField.length>0)for(w=n.grep(JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,function(n){return n.CalculationType==8&&n.Formula.indexOf(r.id)>-1}),u=0;u<w.length;u++)this._tableTreeObj.model.nodeUncheck=null,this._tableTreeObj.uncheckNode(w[u].FieldName),this._tableTreeObj.element.find("li[id='"+w[u].FieldName+"']").removeClass("filter").find(".treeDrop").remove(),this._tableTreeObj.model.nodeUncheck=t.proxy(this._checkedStateModified,this);delete this.model.pivotControl._fieldMembers[r.name];n(i.currentElement).removeClass("filter").find(".filter").remove();n(i.currentElement).removeClass("filter").find(".treeDrop").remove();this.model.pivotControl._ascdes=this.model.pivotControl._ascdes.replace(s+"##","");this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.pivotControl.model.customObject});f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(r),dropAxis:h+"::",sortedHeaders:this.model.pivotControl._ascdes,filterParams:a,currentReport:e,valueSorting:JSON.stringify(this.model.pivotControl.model.valueSortSettings),customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess)}}else this._dataModel=="Pivote"?(this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(r),dropAxis:h+"::"+this._droppedPosition,sortedHeaders:this.model.pivotControl._ascdes,filterParams:a,currentReport:e,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this._droppedPosition="",this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess)):(n(i.currentElement).attr("tag").toLowerCase().indexOf("[measures]")==-1&&(p=t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filter button").addClass("treeDrop")[0].outerHTML,n(i.currentElement.find(".e-text")[0]).after(n(p).hide())),r=n(i.currentElement).attr("tag"),l=this._nodeDropedParams==""?n(i.currentElement).attr("tag").toLowerCase().indexOf("[Measures]")>=0?"Categorical":"Series":this._nodeDropedParams,y=this._currentCubeName+"--"+r+"--"+l+"--",e,this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:y,currentReport:e,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._droppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._droppedSuccess));this._setPivotBtnWidth()}},_clearFilterData:function(n){var i,r;if(!t.isNullOrUndefined(this._tempFilterData))for(i=0;i<this._tempFilterData.length;i++)for(r in this._tempFilterData[i])r==n&&this._tempFilterData[i][n]!=""&&this._tempFilterData.splice(i,1);this.model.pivotControl._tempFilterData=this._tempFilterData},_nodeDropped:function(r){var b,it,nt,et,ot,st,rt,k,ht,tt,u,o,d,l,p,w,h,y,ct,g,a;if(n(r.dropTarget).hasClass("pvtBtn")&&(r.dropTarget=n(r.dropTarget).parents("div.e-droppable").length>0&&n(r.dropTarget).parents(".e-pivotschemadesigner").length>0?n(r.dropTarget).parents("div.e-droppable"):r.dropTarget),n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot){var s="",f=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.pivotControl._dataModel!="XMLA"?n.grep(this.model.pivotTableFields,function(n){return n.caption==r.droppedElement.text()})[0].name:this._dataModel=="XMLA"?r.droppedElement.attr("tag"):r.droppedElement.text(),lt=n(r.droppedElement).attr("id"),ut=r.dropTarget.hasClass("schemaColumn")?"schemaColumn":r.dropTarget.hasClass("schemaRow")?"schemaRow":r.dropTarget.hasClass("schemaFilter")?"schemaFilter":r.dropTarget.hasClass("schemaValue")?"schemaValue":"";if(ut=="")return!1;h=this._setSplitBtnTargetPos(t.isNullOrUndefined(r.event)?r:r.event);try{v=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(vt){v=this.model.pivotControl.getOlapReport()}for(t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),u=0;u<this.model.pivotTableFields.length;u++)if(this.model.pivotTableFields[u].name==f){this.model.pivotTableFields[u].isSelected=!0;s=this.model.pivotTableFields[u];break}a=JSON.stringify({action:this.model.pivotControl.model.enableDeferUpdate?"nodeDroppedDeferUpdate":"nodeDropped",args:JSON.stringify({droppedFieldCaption:f,droppedFieldName:lt,headerTag:s,dropAxis:ut,droppedPosition:h,currentReport:v}),customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a,this._pvtNodeDroppedSuccess);this._isDragging=!1;return}if(this.model.pivotControl._isUpdateRequired=!0,r.dropTarget[0]!=i||r.dropTarget.className!=i){if(b=!1,this._dataModel=="Pivot")for(it=n(r.dropTarget).parents(),u=0;u<it.length;u++)n(it[u]).hasClass("e-pivotgrid")&&(b=!0);if(r.dropTarget.hasClass("e-droppable")||r.dropTarget[0]!=i&&r.dropTarget[0].className.indexOf("e-droppable")>=0||r.dropTarget.className!=i&&r.dropTarget.className.indexOf("e-droppable")>=0||b){this._isDragging=!1;this.element.find(".dropIndicator").removeClass("dropIndicatorHover");var s=n(r.droppedElement).attr("tag"),f=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.pivotControl._dataModel!="XMLA"?n.grep(this.model.pivotTableFields,function(n){return n.caption==r.droppedElement.text()})[0].name:this._dataModel=="XMLA"?r.droppedElement.attr("tag"):r.droppedElement.text(),at="",v,c=this.element.find(".pivotButton:contains("+f+")"),e=this._dataModel=="XMLA"?this._tableTreeObj.element.find("li[tag='"+s+"']").length>1?r.droppedElement:this._tableTreeObj.element.find("li[tag='"+s+"']"):this._dataModel=="Pivot"&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this._tableTreeObj.element.find("li[id="+f+"]"):this._dataModel=="Pivot"?this._tableTreeObj.element.find("li:contains('"+f+"'):last"):this._tableTreeObj.element.find("li[tag='"+s+"']"),y=n(c).find(".filterIndicator").length>0?!0:!1,ft=n(c).find("~ span:eq(0) span.descending").length>0?!0:!1;if(r.dropTarget.parent().attr("role")=="presentation")return!1;if(this.model.pivotControl._dataModel=="XMLA"){if(nt=n.map(n(s.split("].")),function(n){return n.lastIndexOf("]")>=0?n:n+"]"}),nt.length>=2&&(et=nt[0]+"."+nt[1],e=this._tableTreeObj.element.find("li[tag='"+et+"']"),s=e.attr("tag")),ot=n(r.dropTarget).hasClass("value")||n(r.dropTarget).hasClass("colheader")||n(r.dropTarget).hasClass("rowheader")||n(r.dropTarget).hasClass("summary")||n(r.dropTarget).parents("table:eq(0)").hasClass("pivotGridTable")||n(r.dropTarget).parents(".groupingBarPivot").length>0,st=r.droppedElement.find(".namedSetCDB").length>0&&n(r.dropTarget).hasClass("schemaFilter"),ot||st||n(r.droppedElement).attr("tag").toLowerCase().indexOf("measures")>=0&&!n(r.dropTarget).hasClass("schemaValue")||n(r.droppedElement).attr("tag").indexOf("Measures")<0&&n(r.dropTarget).hasClass("schemaValue"))return this._createErrorDialog(),this._waitingPopup.hide(),!1;if(rt=t.Pivot.getReportItemByFieldName(s,this.model.pivotControl.model.dataSource,this._dataModel),k=rt.axis,!(e.length>1)&&rt.item.length>0&&(k=="rows"&&r.dropTarget.hasClass("schemaRow")||k=="columns"&&r.dropTarget.hasClass("schemaColumn")||k=="values"&&n(r.dropTarget).hasClass("schemaValue")||k=="filters"&&n(r.dropTarget).hasClass("schemaFilter")))return!1;if(e.length>1&&r.droppedElement.find(".kpiValue").length>0&&(e=e.find(".kpiValue").parents("li:eq(0)")),this._tableTreeObj.isNodeChecked(e))for(u=0;u<this.element.find(".pivotButton").length;u++)this.element.find(".pivotButton:eq("+u+")").attr("tag").split(":")[1]==s?this.element.find(".pivotButton:eq("+u+")").remove():""}else if(this._dataModel=="Olap"&&(n(r.droppedElement).attr("tag").indexOf("Measures")>=0&&(n(r.dropTarget).hasClass("schemaFilter")||n(r.dropTarget).hasClass("drag"))||n(r.droppedElement).attr("tag").indexOf("Measures")<0&&n(r.dropTarget).hasClass("schemaValue")))return this._createErrorDialog(),this._waitingPopup.hide(),!1;if(n(e).find(".filter").remove(),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)for(c=[],u=0;u<this.element.find(".pivotButton").length;u++)uniqueName=n(this.element.find(".pivotButton")[u]).find("button").attr("fieldName"),uniqueName==f&&c.push(this.element.find(".pivotButton")[u]);if(b)if(r.event.target.tagName=="TH"||r.event.target.tagName=="TD"||n(r.event.target).hasClass("cellValue")&&(n(r.event.target).parent("th").length>0||n(r.event.target).parent("td").length>0)){if(n(r.event.target).hasClass("cellValue")&&(n(r.event.target).parent("th").length>0?r.event.target=n(r.event.target).parent("th")[0]:n(r.event.target).parent("td").length>0&&(r.event.target=n(r.event.target).parent("td")[0])),this._droppedClass=r.event.target.className.split(" ")[0]=="rowheader"||r.event.target.className.split(" ")[0]=="grpRow"?"schemaRow":r.event.target.className.split(" ")[0]=="colheader"?"schemaColumn":n(r.event.target).hasClass("value")?"schemaValue":"",this._droppedClass=="")return}else this._droppedClass=r.event.target.className.split(" ")[0]=="rows"||r.event.target.className.split(" ")[0]=="emptyRows"?"schemaRow":r.event.target.className.split(" ")[0]=="columns"?"schemaColumn":r.event.target.className.split(" ")[0]=="values"?"schemaValue":r.event.target.className.split(" ")[0]=="drag"?"schemaFilter":"";else this._droppedClass=t.isNullOrUndefined(r.event)?r.dropTarget.hasClass("schemaColumn")?"schemaColumn":r.dropTarget.hasClass("schemaRow")?"schemaRow":r.dropTarget.hasClass("schemaFilter")?"schemaFilter":r.dropTarget.hasClass("schemaValue")?"schemaValue":"":r.event.target.className.split(" ")[0];if(this._dataModel=="Olap"&&(ht=n(r.droppedElement).children("div:eq(0)").find(".e-checkbox").length,e=ht==0?r.droppedElement.parent("ul").parent("li:eq(0)"):r.droppedElement),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._dataModel=="Pivot"&&this._droppedClass!="schemaValue"&&(n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==e.attr("id")}).length>0||n.grep(JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,function(n){return n.FieldName==e.attr("id")&&n.CalculationType==8}).length>0)){this.model.pivotControl._createErrorDialog(this.model.pivotControl._getLocalizedLabels("CalcValue"),this.model.pivotControl._getLocalizedLabels("Warning"));return}if(e.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="schemaRow"||this._droppedClass=="schemaColumn"||this._droppedClass=="schemaFilter"||this._droppedClass=="schemaValue"))return this._tableTreeObj.checkNode(e),!1;if(e.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="pvtBtn"||this._droppedClass=="rowheader"||this._droppedClass=="colheader"||this._droppedClass=="value"&&n(r.droppedElement).attr("tag").indexOf("Measures")<0)&&(this._nodeCheck=!0,this._tableTreeObj.checkNode(e)),t.isNullOrUndefined(s))for(u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].name==f&&(this.model.pivotTableFields[u].isSelected=!0,s=this.model.pivotTableFields[u]);if(!t.isNullOrUndefined(this._tempFilterData))for(u=0;u<this._tempFilterData.length;u++)if(!t.isNullOrUndefined(this._tempFilterData[u][f]))for(tt=0;tt<this._tempFilterData[u][f].length;tt++)at+="##"+this._tempFilterData[u][f][tt];if(r.droppedElement[0].tagName.toLowerCase()=="button")if(c.length>1)for(u=0;u<c.length;u++)n(c[u]).text()==f&&n(c[u]).remove();else n(c).remove();try{v=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(vt){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(v=this.model.pivotControl.getOlapReport())}if(this.model.pivotControl._dataModel=="XMLA"&&(v=this.model.pivotControl.model.dataSource),this._dataModel=="Pivot"||this.model.pivotControl._dataModel=="XMLA"){for(f=this.model.pivotControl._dataModel=="XMLA"?s:f,h="",h=b?this._droppedPosition="":t.isNullOrUndefined(r.event)?"":this._droppedPosition=this._setSplitBtnTargetPos(r.event),u=0;u<this.model.pivotTableFields.length;u++)if(this.model.pivotTableFields[u].name==f){this.model.pivotTableFields[u].isSelected=!0;s=this.model.pivotTableFields[u];n(c).remove();break}if(e.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="schemaRow"||this._droppedClass=="schemaColumn"||this._droppedClass=="schemaFilter"||this._droppedClass=="schemaValue"))this._tableTreeObj.checkNode(e);else if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(o=this.model.pivotControl._getDroppedItem(f),o.length&&o[0].filterItems&&o[0].filterItems.values&&o[0].filterItems.values.length&&n(n(e).find(".e-text")[0]).after(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filtered").addClass("filter")[0].outerHTML),o.length||(o[0]={fieldName:f,fieldCaption:this._dataModel=="XMLA"&&e.find(".hierarchyCDB ").length>0?e.find("div:eq(0)").text():f}),this.model.pivotControl.model.dataSource.columns=n.grep(this.model.pivotControl.model.dataSource.columns,function(n){return n.fieldName!=f}),this.model.pivotControl.model.dataSource.rows=n.grep(this.model.pivotControl.model.dataSource.rows,function(n){return n.fieldName!=f}),this._dataModel!="XMLA"?this.model.pivotControl.model.dataSource.values=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.fieldName!=f}):this.model.pivotControl.model.dataSource.values[0].measures=n.grep(this.model.pivotControl.model.dataSource.values[0].measures,function(n){return n.fieldName!=f}),this.model.pivotControl.model.dataSource.filters=n.grep(this.model.pivotControl.model.dataSource.filters,function(n){return n.fieldName!=f}),d=this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",this.model.pivotControl._dataModel=="Pivot"&&n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==o[0].fieldCaption}).length>0&&d!="value"){alert(this.model.pivotControl._getLocalizedLabels("CalcValue"));this._tableTreeObj.checkNode(o[0].fieldCaption);return}this._createPivotButton(o[0],d,y,ft,h);n.isNumeric(h)?this._droppedClass=="schemaRow"?this.model.pivotControl.model.dataSource.rows.splice(h,0,o[0]):this._droppedClass=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.splice(h,0,o[0]):this._droppedClass=="schemaValue"?this.model.pivotControl._dataModel=="XMLA"?this.model.pivotControl.model.dataSource.values[0].measures.splice(h,0,o[0]):this.model.pivotControl.model.dataSource.values.splice(h,0,o[0]):this.model.pivotControl.model.dataSource.filters.splice(h,0,o[0]):this._droppedClass=="schemaRow"?this.model.pivotControl.model.dataSource.rows.push(o[0]):this._droppedClass=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.push(o[0]):this._droppedClass=="schemaValue"?this.model.pivotControl._dataModel=="XMLA"?this.model.pivotControl.model.dataSource.values[0].measures.push(o[0]):this.model.pivotControl.model.dataSource.values.push(o[0]):this.model.pivotControl.model.dataSource.filters==null?(this.model.pivotControl.model.dataSource.filters=[],this.model.pivotControl.model.dataSource.filters.push(o[0])):this.model.pivotControl.model.dataSource.filters.push(o[0]);this.model.pivotControl._dataModel=="Pivot"&&this.model.pivotControl._calculatedField.length>0&&d!="value"&&(this.model.pivotControl._calcFieldNodeDrop(o[0]),this.model.pivotControl.model.dataSource.values=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return t.isNullOrUndefined(n.isCalculatedField)||n.isCalculatedField==!1||n.isCalculatedField==!0&&n.formula.indexOf(o[0].fieldName)==-1}));this.model.pivotControl._dataModel=="XMLA"?(this._droppedClass=="schemaFilter"&&(this.model.pivotControl.model.dataSource.filters=n.map(this.model.pivotControl.model.dataSource.filters,function(n){return n.advancedFilter=[],n})),t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(this._trigger("fieldItemDropped",{axis:d,fieldItem:e}),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}else y=!1,this._tempFilterData!=null&&n.each(this._tempFilterData,function(t,i){n.each(i,function(t,i){t==n(e).attr("id")&&i.length>0&&(y=!0)})}),y&&n(n(e).find(".e-text")[0]).after(t.buildTag("span.e-icon").addClass("filter")[0].outerHTML),this._dataModel=="Pivot"&&this.model.pivotControl._calculatedField.length>0&&this._droppedClass!="schemaValue"&&this.model.pivotControl._calculatedFieldNodeRemove(s),this._createPivotButton({fieldName:s.id,fieldCaption:f},this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",y,ft,h),g="",g=t.Pivot._getFilterParams(this._droppedClass,this._tempFilterData,f),this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),a=JSON.stringify({action:"nodeDropped",dropAxis:this._droppedClass+"::"+h,filterParams:g,headerTag:JSON.stringify(s),sortedHeaders:this.model.pivotControl._ascdes,currentReport:v,valueSorting:this.model.pivotControl.model.valueSortSettings,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a,this._pvtNodeDroppedSuccess)}else{if(l=r.dropTarget[0]!=i&&r.dropTarget[0].className=="pivotButton"?n(r.dropTarget).parents()[0]:r.dropTarget[0]!=i&&r.dropTarget[0].tagName.toLowerCase()=="td"&&!n(r.dropTarget.parents("table.pivotGridTable")[0]).length?r.dropTarget.children(":last")[0]:r.dropTarget,this._droppedClass=l[0].className.split(" ")[0],p="",w="",p=l[0].className.split(" ")[0],n(r.dropTarget.parents("table.pivotGridTable")[0]).length){if(w=n(l).hasClass("rowheader")?"Series":n(l).hasClass("grpRow")?"Series":n(l).hasClass("rows")?"Series":n(l).hasClass("colheader")?"Categorical":n(l).hasClass("columns")?"Categorical":n(l).hasClass("value")?"Slicer":n(l).hasClass("drag")?"Slicer":"",n(r.droppedElement).attr("tag").indexOf("Measures")>0&&w=="Slicer")return this._createErrorDialog(),!1}else w=p=="columns"?"Categorical":p=="schemaColumn"?"Categorical":p=="rows"?"Series":p=="schemaRow"?"Series":p=="drag"?"Slicer":p=="schemaFilter"?"Slicer":"";w==""&&(w=this.element.find(".schemaRow .pivotButton:contains('Measures')").length>0||this.element.find(".schemaRow .pivotButton:contains('MEASURES')").length>0?"Series":"Categorical");h=t.isNullOrUndefined(r.event)?"":this._setSplitBtnTargetPos(r.event);y=!1;this.model.pivotControl._tempFilterData!=null&&n.each(this.model.pivotControl._tempFilterData,function(t,i){n.each(i,function(n,t){n==s.replace(/[\[\]']/g,"")&&t.length>0&&(y=!0)})});y&&n(n(e).find(".e-text")[0]).after(t.buildTag("span.e-icon").addClass("filter")[0].outerHTML);ct=this._currentCubeName+"--"+s+"--"+w+"--"+h;g="";this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject});a=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:ct,filterParams:g,currentReport:v,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show();this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a.replace("nodeDropped","nodeDroppedDeferUpdate"),this._droppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a,this._droppedSuccess)}}this._setPivotBtnWidth()}},_addTreeDropIcon:function(i){this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(n(args.currentElement).attr("tag").toLowerCase().indexOf("[measures]")<0&&!(n(args.currentElement).find(".namedSetCDB").length>0)?i.after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML):i.after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML))},_removeUndefinedFields:function(n){for(var i in n)(i=="droppedFieldFormat"||i=="droppedFieldFormatString")&&(t.isNullOrUndefined(n[i])||n[i]=="")&&delete n[i];return n},_clientPivotCheckedStateModified:function(i){var u,s,f;if(t.PivotAnalysis._valueSorting=null,!this._isDropAction){var r="",e="",o="";t.isNullOrUndefined(this.model.pivotControl)||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show();this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(r=n.grep(this.model.pivotTableFields,function(t){return t.name==n(i.currentElement).attr("id")})[0].name,e=n.grep(this.model.pivotTableFields,function(t){return t.name==n(i.currentElement).attr("id")})[0].format,o=n.grep(this.model.pivotTableFields,function(t){return t.name==n(i.currentElement).attr("id")})[0].formatString):r=n(i.currentElement).attr("tag"):r=n(i.currentElement).find("a")[0].textContent;i.type=="nodeUncheck"?(delete this.model.pivotControl._fieldMembers[r.toLowerCase()],delete this.model.pivotControl._fieldSelectedMembers[r.toLowerCase()],t.Pivot.removeReportItem(this.model.pivotControl.model.dataSource,r,!1),n(i.currentElement).removeClass("filter").find(".treeDrop,.filter").remove()):(u="row",this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&n(i.currentElement).attr("tag").toLocaleLowerCase().indexOf("[measures]")>=0&&(u="value"),(this.model.pivotControl.model.analysisMode!=t.Pivot.AnalysisMode.Olap||n(i.currentElement).attr("tag").toLowerCase().indexOf("[measures]")<0&&n(i.currentElement).find(".namedSetCDB").length==0)&&n(i.currentElement.find(".e-text")).after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML),s=n(i.currentElement).find("a")[0].textContent,f={droppedFieldName:r,droppedFieldCaption:s,droppedFieldFormat:e,droppedFieldFormatString:o,droppedClass:u,droppedPosition:"",isMeasuresDropped:r.toLocaleLowerCase().indexOf("measures")==0},this._removeUndefinedFields(f),t.Pivot.addReportItem(this.model.pivotControl.model.dataSource,f));this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"},this.model.pivotControl);this._refreshPivotButtons();this.model.pivotControl.refreshControl();this._setPivotBtnWidth()}},_clientOnNodeDropped:function(i){var s,o,r,l,a,h,k;t.PivotAnalysis._valueSorting=null;this._isDragging=!1;var c=!1,v=this,u=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null;if(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot)for(s=n(i.dropTarget).parents(),o=0;o<s.length;o++)s[o].className.split(" ")[0]=="e-pivotgrid"&&(c=!0);var f=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?n.grep(this.model.pivotTableFields,function(n){return n.name==i.droppedElement.attr("id")})[0].name:i.droppedElement.attr("defaulthierarchy")||(n(i.droppedElement).find("a:eq(0) span[class^='level'],div[class*='level']").length>0?n(i.droppedElement).parents("li:eq(0)").attr("tag"):i.droppedElement.attr("tag")),y=n(i.droppedElement).find("div:first").text(),r="",e=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?n.grep(this.model.pivotTableFields,function(n){return n.name==i.droppedElement.attr("id")})[0]:null,p=t.isNullOrUndefined(e)?"":e.format,w=t.isNullOrUndefined(e)?"":e.formatString,b=t.isNullOrUndefined(e)?!0:e.showSubTotal;if(r=n(i.dropTarget).hasClass("pvtBtn")||n(i.dropTarget).hasClass("pivotButton")?n(i.dropTarget).parents("div.e-droppable").hasClass("schemaColumn")?"column":n(i.dropTarget).parents("div.e-droppable").hasClass("schemaRow")?"row":n(i.dropTarget).parents("div.e-droppable").hasClass("schemaFilter")?"filter":n(i.dropTarget).parents("div.e-droppable").hasClass("schemaValue")?"value":"":i.dropTarget.hasClass("schemaColumn")?"column":i.dropTarget.hasClass("schemaRow")?"row":i.dropTarget.hasClass("schemaFilter")?"filter":i.dropTarget.hasClass("schemaValue")?"value":"",c&&(r=n(i.dropTarget).prop("tagName")=="TH"||n(i.dropTarget).prop("tagName")=="TD"?n(i.dropTarget).hasClass("rowheader")||n(i.dropTarget).hasClass("grpRow")?"row":n(i.dropTarget).hasClass("colheader")?"column":n(i.dropTarget).hasClass("value")?"value":"":n(i.dropTarget).hasClass("rows")||n(i.dropTarget).hasClass("emptyRows")?"row":n(i.dropTarget).hasClass("columns")?"column":n(i.dropTarget).hasClass("values")?"value":n(i.dropTarget).hasClass("drag")?"filter":""),r=="")return!1;if(l=t.isNullOrUndefined(i.event)?"":this._setSplitBtnTargetPos(i.event),a=n(i.dropTarget).hasClass("value")||n(i.dropTarget).hasClass("colheader")||n(i.dropTarget).hasClass("rowheader")||n(i.dropTarget).hasClass("summary")||n(i.dropTarget).parents("table:eq(0)").hasClass("pivotGridTable")||n(i.dropTarget).parents(".groupingBarPivot").length>0,f.toLowerCase().indexOf("[measures]")>=0&&r!="value"||f==this._getLocalizedLabels("Measures")&&r!="row"&&r!="column"||this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&f.toLowerCase().indexOf("[measures]")<0&&r=="value"||a&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap){this._createErrorDialog();return}this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.pivotControl._fieldMembers={},this.model.pivotControl._fieldSelectedMembers={},f.toLowerCase().indexOf("[measures")>=0&&(this.model.pivotControl.model.dataSource.values[0].axis=r=="column"?"columns":r=="row"?"rows":this.model.pivotControl.model.dataSource.values[0].axis,r="value"));t.isNullOrUndefined(u)?this.model.pivotControl._waitingPopup.show():(u._isTimeOut=!0,setTimeout(function(){u._isTimeOut&&v.model.pivotControl._waitingPopup.show()},800));h={droppedFieldName:f,droppedFieldCaption:y,droppedFieldFormat:p,droppedFieldFormatString:w,droppedFieldShowSubTotal:b,droppedClass:r,droppedPosition:l,isMeasuresDropped:f.toLocaleLowerCase().indexOf("measures")==0};this._removeUndefinedFields(h);t.Pivot.addReportItem(this.model.pivotControl.model.dataSource,h);this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"},this.model.pivotControl);this.model.pivotControl.element.hasClass("e-pivotclient")&&this.model.pivotControl._pivotChart&&(this.model.pivotControl._pivotChart._labelCurrentTags={});k=i.droppedElement;this._isDropAction=!0;r==""?this._tableTreeObj.uncheckNode(i.droppedElement):(n(i.droppedElement).find(".treeDrop").length==0&&this.element.parents(".e-pivotclient").length==0&&(this.model.pivotControl.model.analysisMode!=t.Pivot.AnalysisMode.Olap||n(i.droppedElement).attr("tag").toLowerCase().indexOf("[measures]")<0&&n(i.droppedElement).find(".namedSetCDB").length==0)&&n(i.droppedElement.find(".e-text")).after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML),this._tableTreeObj.checkNode(i.droppedElement));this._isDropAction=!1;this._refreshPivotButtons();this.model.pivotControl.refreshControl();this._setPivotBtnWidth();t.isNullOrUndefined(u)||u._isTimeOut&&(u._isTimeOut=!1)},_clientOnPvtBtnDropped:function(i){var l,f,y,u,p,o,s,h,e,w,c;t.PivotAnalysis._valueSorting=null;l=this;f=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null;t.isNullOrUndefined(this.model.pivotControl)||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||(t.isNullOrUndefined(f)?this.model.pivotControl._waitingPopup.show():(f._isTimeOut=!0,setTimeout(function(){f._isTimeOut&&f.element.find(".errorDialog:visible").length==0&&l.model.pivotControl._waitingPopup.show()},800)));n(i.target).hasClass("removeClientPivotBtn")&&(i.target=n(i.target).parent());this._isDragging=!1;n("#"+this._id+"_dragClone").remove();var r="",a="",v="";if(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(r=n.grep(this.model.pivotTableFields,function(t){return t.name==n(i.element).attr("fieldName")})[0].name,a=n.grep(this.model.pivotTableFields,function(t){return t.name==n(i.element).attr("fieldName")})[0].format,v=n.grep(this.model.pivotTableFields,function(t){return t.name==n(i.element).attr("fieldName")})[0].formatString):r=n(i.element).attr("fieldName"):r=i.element.text(),y=i.element.text(),t.isNullOrUndefined(this.model.pivotControl._fieldMembers)||(delete this.model.pivotControl._fieldMembers[r.toLowerCase()],delete this.model.pivotControl._fieldSelectedMembers[r.toLowerCase()]),u="",u=n(i.target).hasClass("pvtBtn")||this.element.parents(".e-pivotclient").length>0&&n(i.target).hasClass("pivotButton")?n(i.target).parents("div.e-droppable").hasClass("schemaColumn")?"column":n(i.target).parents("div.e-droppable").hasClass("schemaRow")?"row":n(i.target).parents("div.e-droppable").hasClass("schemaFilter")?"filter":n(i.target).parents("div.e-droppable").hasClass("schemaValue")?"value":"":n(i.target).hasClass("schemaColumn")?"column":n(i.target).hasClass("schemaRow")?"row":n(i.target).hasClass("schemaFilter")?"filter":n(i.target).hasClass("schemaValue")?"value":"",r.toLowerCase().indexOf("[measures]")>=0&&u!="value"&&(u=="row"||u=="column"||u=="filter")||r==this._getLocalizedLabels("Measures")&&u!="row"&&u!="column"&&(u=="value"||u=="filter")||this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&r.toLowerCase().indexOf("[measures]")<0&&u=="value"){this._createErrorDialog();i.element.removeClass("dragHover").parent().removeClass("dragHover");return}if(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl._calculatedField!=null&&u!="value"&&n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==r}).length>0){t.Pivot._createErrorDialog(this.model.pivotControl._getLocalizedLabels("CalcValue"),this.model.pivotControl._getLocalizedLabels("Warning"),this);i.element.removeClass("dragHover").parent().removeClass("dragHover");this.element.find(".dropIndicator").removeClass("dropIndicatorHover");this.model.pivotControl._waitingPopup.hide();return}if(p=t.isNullOrUndefined(i.event)?"":this._setSplitBtnTargetPos(i.event),o={droppedFieldName:r,droppedFieldCaption:y,droppedFieldFormat:a,droppedFieldFormatString:v,droppedClass:u,droppedPosition:p,isMeasuresDropped:r.toLocaleLowerCase().indexOf("measures")==0},this._removeUndefinedFields(o),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(r==this._getLocalizedLabels("Measures")||r=="[Measures]")&&(s=this.model.pivotControl.model.dataSource.values[0].measures),t.Pivot.addReportItem(this.model.pivotControl.model.dataSource,o),this.model.pivotControl._calculatedField!=null&&this.model.pivotControl._calculatedField.length>0&&u!="value")for(h=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.isCalculatedField==!0&&n.formula.indexOf(r)>-1}),e=0;e<h.length;e++)this._tableTreeObj.uncheckNode(h[e].fieldName);this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl._calculatedField!=null&&this.model.pivotControl._calculatedField.length>0&&(w=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.isCalculatedField==!0}),this.model.pivotControl.model.dataSource.values=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return t.isNullOrUndefined(n.isCalculatedField)||n.isCalculatedField==!1}),n.merge(this.model.pivotControl.model.dataSource.values,w));this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.pivotControl._fieldMembers={},this.model.pivotControl._fieldSelectedMembers={},t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"},this.model.pivotControl));this.model.pivotControl.element.hasClass("e-pivotclient")&&this.model.pivotControl._pivotChart&&(this.model.pivotControl._pivotChart._labelCurrentTags={});u==""&&(this._isDropAction=!0,this._tableTreeObj.element.find("li[tag='"+r+"']").removeClass("filter").find(".treeDrop,.filter").remove(),t.isNullOrUndefined(s)?this._tableTreeObj.uncheckNode(this._tableTreeObj.element.find("li[tag='"+r+"']")):(c=this,n.grep(s,function(n){c._tableTreeObj.uncheckNode(c._tableTreeObj.element.find("li[tag='"+n.fieldName+"']"))})),this._isDropAction=!1);this._refreshPivotButtons();this.model.pivotControl.refreshControl();this._setPivotBtnWidth()},_refreshPivotButtons:function(){this.element.find(".axisTable .schemaFilter").html(this._createPivotButtons("filters",this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.filters:JSON.parse(this.model.pivotControl.getOlapReport()).Filters));this.element.find(".axisTable .schemaRow").html(this._createPivotButtons("rows",this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.rows:JSON.parse(this.model.pivotControl.getOlapReport()).PivotRows));this.element.find(".axisTable .schemaColumn").html(this._createPivotButtons("columns",this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.columns:JSON.parse(this.model.pivotControl.getOlapReport()).PivotColumns));this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.dataSource.values.length>0&&!t.isNullOrUndefined(this.model.pivotControl.model.dataSource.values[0].measures)&&this.model.pivotControl.model.dataSource.values[0].measures.length>0&&(this.model.pivotControl.model.dataSource.values[0].axis=="columns"?this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons("columns",[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}])):this.model.pivotControl.model.dataSource.values[0].axis=="rows"&&this.element.find(".axisTable .schemaRow").append(this._createPivotButtons("rows",[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}])));this.element.find(".axisTable .schemaValue").html(this._createPivotButtons("values",this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.values:JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations));this.model.enableDragDrop&&this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)});this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&this.element.find(".pvtBtn").css("max-width",this.element.find(".schemaColumn").width()-this.element.find(".removeClientPivotBtn").width()-6);this._createContextMenu();this.model.pivotControl.model.isResponsive&&this.model.pivotControl.model.enableSplitter&&!t.isNullOrUndefined(this.model.pivotControl.element.find(".splitresponsive").data("ejSplitter"))&&this.model.pivotControl.element.find(".splitresponsive").data("ejSplitter").refresh();this._setSplitButtonTitle();this.model.pivotControl.model.showUniqueNameOnPivotButton&&n(".pvtBtnDiv").addClass("schemaBtnUnique");this.element.parents(".e-pivotclient").length>0||this._setPivotBtnWidth()},_setSplitButtonTitle:function(){var i,r,f,u;if(this.element.find(".pvtBtn").length>0&&this._tableTreeObj!=null)for(i=0;i<this.element.find(".pvtBtn").length;i++)r=this.element.find(".pvtBtn:eq("+i+")").attr("fieldname"),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(f=this._tableTreeObj.element.find("li[tag='"+r+"']").parents("li:eq(0)").find("a:eq(0)").text(),u=this.element.find(".pvtBtn:eq("+i+")").text(),r.toLowerCase().indexOf("measures")>=0?this.element.find(".pvtBtn:eq("+i+")").attr("title",u):this.element.find(".pvtBtn:eq("+i+")").attr("title",f+" - "+u)):this.element.find(".pvtBtn:eq("+i+")").attr("title",n.grep(this.model.pivotTableFields,function(n){return n.id==r})[0].caption)},_createPivotButtons:function(r,u){var h="",a=r,r,f,e;if(t.isNullOrUndefined(this.model.pivotControl)||this.model.pivotControl.model.operationalMode!=t.Pivot.OperationalMode.ClientMode)for(r=="values"&&(r=this.element.find(".pivotButton:contains("+this._getLocalizedLabels("Measures")+")").length>0?this.element.find(".pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").parent()[0].className.split(" ")[0]:"schemaColumn",r=r=="schemaColumn"?"columns":"rows"),f=0;f<u.length;f++)e="",t.isNullOrUndefined(this.model.pivotControl)||r!="filters"&&r!="slicers"||(e=t.Pivot._getFilterState("",[],u[f],this.model.pivotControl),r=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"slicers":r),h+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+(n(this.element).parents(".e-pivotclient").length>0?t.buildTag("button.pvtBtn#pivotButton"+(u[f].FieldHeader||u[f].FieldName||u[f].DimensionHeader||u[f].DimensionName||u[f].Name),(this.model.pivotControl.model.showUniqueNameOnPivotButton?r!="values"?u[f].Tag:u[f].FieldHeader||u[f].FieldName||u[f].DimensionHeader||u[f].DimensionName||u[f].Name:u[f].FieldHeader||u[f].FieldName||u[f].DimensionHeader||u[f].DimensionName||u[f].Name)+((r=="filters"||r=="slicers")&&e!=""?" ("+e+")":""),{},{fieldName:u[f].FieldName||u[f].DimensionName||u[f].FieldHeader||u[f].DimensionHeader||u[f].Name||u[f],fieldCaption:u[f].FieldHeader||u[f].DimensionHeader||u[f].FieldName||u[f].DimensionName,axis:r})[0].outerHTML:t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+(u[f].FieldHeader||u[f].FieldName||u[f].DimensionHeader||u[f].DimensionName||u[f].Name),(this.model.pivotControl.model.showUniqueNameOnPivotButton?a!="values"?u[f].Tag:u[f].FieldHeader||u[f].FieldName||u[f].DimensionHeader||u[f].DimensionName||u[f].Name:u[f].FieldHeader||u[f].FieldName||u[f].DimensionHeader||u[f].DimensionName||u[f].Name)+((r=="filters"||r=="slicers")&&e!=""?" ("+e+")":""),{},{fieldName:u[f].FieldName||u[f].DimensionName||u[f].FieldHeader||u[f].DimensionHeader||u[f].Name||u[f],fieldCaption:u[f].FieldHeader||u[f].DimensionHeader||u[f].FieldName||u[f].DimensionName,axis:r})[0].outerHTML).attr("tag",r+":"+u[f].Tag)[0].outerHTML)+t.buildTag("span."+(this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?"removeClientPivotBtn":"removePivotBtn"),{},{display:this.model.layout!=t.PivotSchemaDesigner.Layouts.OneByOne?"none":"inline-block"}).addClass("e-icon")[0].outerHTML).attr("tag",r+":"+u[f].Tag)[0].outerHTML;else for(r=="values"&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(u=n.map(u,function(n){return n.measures})),f=0;f<u.length;f++){var l=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"":u[f].fieldName,o=n.grep(this.model.pivotTableFields,function(n){return n.name==u[f].fieldName}),s=n.grep(this.model.pivotTableFields,function(n){return n.name==u[f]});o.length>0&&(o=o[0].caption);s.length>0&&(s=s[0].caption);var e="",c=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?!0:!1,v=c?"":t.PivotAnalysis.getMembers(u[f].fieldName),y=u[f].filterItems!=null&&u[f].filterItems.values.length>0?"filtered":"";r=="filters"&&(y=="filtered"?e=t.Pivot._getFilterState(c,v,u[f],this.model.pivotControl):c?(t.olap._mdxParser.getAllMember(this.model.pivotControl.model.dataSource,u[f].fieldName,this.model.pivotControl),e=this.model.pivotControl._allMember):e=this.model.pivotControl._getLocalizedLabels("All"));h+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+(n(this.element).parents(".e-pivotclient").length>0?t.buildTag("button.pvtBtn#pivotButton"+l,(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.pivotControl.model.showUniqueNameOnPivotButton?r!="values"?u[f].fieldName.replace(/\[/g,"").replace(/\]/g,""):(u[f].fieldCaption!=i?u[f].fieldCaption:u[f].fieldName)||u[f]:(u[f].fieldCaption!=i?u[f].fieldCaption:u[f].fieldName)||u[f]:o||s)+(r=="filters"&&e!=""?" ("+e+")":""),{},{fieldName:u[f].fieldName||u[f],fieldCaption:u[f].fieldCaption||u[f].fieldName,axis:r})[0].outerHTML:t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+l,(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.pivotControl.model.showUniqueNameOnPivotButton?r!="values"?u[f].fieldName.replace(/\[/g,"").replace(/\]/g,""):(u[f].fieldCaption!=i?u[f].fieldCaption:u[f].fieldName)||u[f]:(u[f].fieldCaption!=i?u[f].fieldCaption:u[f].fieldName)||u[f]:o||s)+(r=="filters"&&e!=""?" ("+e+")":""),{},{fieldName:u[f].fieldName||u[f],fieldCaption:u[f].fieldCaption||u[f].fieldName,axis:r})[0].outerHTML).attr("tag",r+":"+u[f].fieldName)[0].outerHTML)+t.buildTag("span."+(this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?"removeClientPivotBtn":"removePivotBtn"),{},{display:this.model.layout!=t.PivotSchemaDesigner.Layouts.OneByOne?"none":"inline-block"}).addClass("e-icon")[0].outerHTML).attr("tag",r+":"+u[f].fieldName||u[f])[0].outerHTML}return h},_pvtBtnDropped:function(r){var s,h,it,a,l,rt,b,k,et,f,d,g,ut,nt,o,ft,tt,ot;if(this.element.find(".dropIndicator").removeClass("dropIndicatorHover"),n(r.element).parent().removeClass("dragHover"),n(r.element).removeClass("dragHover"),n("#"+this._id+"_dragClone").remove(),s="",this._isDragging=!1,n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot){n(r.target).hasClass("pivotButton")&&(r.target=r.target.childNodes[1]);var u=t.isNullOrUndefined(r.target.className.indexOf)?"":n(r.target).attr("class")?r.target.className.indexOf("e-droppable")>=0?r.target.className.split(" ")[0]:r.target.className.split(" ")[0]=="pvtBtn"?n(r.target).parents("div.e-droppable").attr("class").split(" ")[0]:"":"",e=r.element.attr("fieldcaption")||r.element.attr("fieldname"),a,p=r.element.parent().attr("tag").split(":")[1],h=t.isNullOrUndefined(r.event)?"":this._setSplitBtnTargetPos(r.event);for(o=0;o<this.model.pivotTableFields.length;o++)if(this.model.pivotTableFields[o].name==e){this.model.pivotTableFields[o].isSelected=!0;s=this.model.pivotTableFields[o];break}try{a=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(st){a=this.model.pivotControl.getOlapReport()}t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show();u==""&&(delete this.model.pivotControl._fieldMembers[p],delete this.model.pivotControl._fieldSelectedMembers[p]);l=JSON.stringify({action:this.model.pivotControl.model.enableDeferUpdate?"nodeDroppedDeferUpdate":"nodeDropped",args:JSON.stringify({droppedFieldCaption:e,droppedFieldName:p,headerTag:s,dropAxis:u,droppedPosition:h,currentReport:a,sortedHeaders:t.isNullOrUndefined(this.model.pivotControl._ascdes)?"":this.model.pivotControl._ascdes}),customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l,this._pvtNodeDroppedSuccess);return}this.model.pivotControl._isUpdateRequired=!0;this._isDragging=!1;var c=null,v="",e,u,y=y=r.element.find("~ .filtered").length>0?!0:!1,w=!1;if(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap)c=t.isNullOrUndefined(r.target.className)?r.target:r.target.className.indexOf("pvtBtn")>-1?n(r.target).parents(".e-droppable")[0]:r.target.className.indexOf("e-droppable")?r.target:r.target[0].tagName.toLowerCase()=="td"?r.target.children(":last")[0]:r.target,t.isNullOrUndefined(c.className)?(v=c.hasClass("schemaColumn")?"Categorical":c.hasClass("schemaRow")?"Series":c.hasClass("schemaFilter")?"Slicer":"",this._droppedClass=u=c.hasClass("schemaColumn")?"schemaColumn":c.hasClass("schemaRow")?"schemaRow":c.hasClass("schemaFilter")?"schemaFilter":c.hasClass("schemaValue")?"schemaValue":""):(v=c.className.split(" ")[0]=="schemaColumn"?"Categorical":c.className.split(" ")[0]=="schemaRow"?"Series":c.className.split(" ")[0]=="schemaFilter"?"Slicer":"",u=c.className.split(" ")[0]),v==""&&r.element.parent().attr("tag").toLowerCase().indexOf("[measures]")>-1&&(v=this.element.find(".schemaRow .pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").length>0?"Series":"Categorical"),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?e=s=n(r.element.parent()[0]).attr("tag").split(":")[1]:s=n(r.element.parent()[0]).attr("tag");else for(u=t.isNullOrUndefined(r.target.className)?n(r.target).hasClass("schemaColumn")?"schemaColumn":n(r.target).hasClass("schemaRow")?"schemaRow":n(r.target).hasClass("schemaFilter")?"schemaFilter":n(r.target).hasClass("schemaValue")?"schemaValue":"":r.target.className.indexOf("e-droppable")>=0?r.target.className.split(" ")[0]:r.target.className.split(" ")[0]=="pvtBtn"?n(r.target).parents("div.e-droppable").attr("class").split(" ")[0]:"",e=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n.grep(this.model.pivotTableFields,function(n){return n.caption==r.element.text()})[0].name:r.element.attr("fieldCaption"),s,y=r.element.find("~ .filterIndicator").length>0?!0:!1,w=r.element.find("~ span:eq(0) span.descending").length>0?!0:!1,o=0;o<this.model.pivotTableFields.length;o++)this.model.pivotTableFields[o].name==e&&(this.model.pivotTableFields[o].isSelected=!0,s=this.model.pivotTableFields[o]);if(this._dataModel=="Olap"&&(s.split(":")[1].toLocaleUpperCase()=="MEASURES"&&(u!="schemaColumn"||u!="schemaRow")&&(u=="schemaFilter"||u=="schemaValue")||s.toUpperCase().indexOf("[MEASURES]")>-1&&u!="schemaValue"&&(u=="schemaRow"||u=="schemaColumn"||u=="schemaFilter")||s.toUpperCase().indexOf("[MEASURES]")==-1&&u=="schemaValue"))return this._createErrorDialog(),!1;if(u=="schemaValue"||u=="schemaRow"||u=="schemaColumn"||u=="schemaFilter"){if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._dataModel=="Pivot"&&u!="schemaValue"&&(n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==e}).length>0||n.grep(JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,function(n){return n.FieldHeader==e&&n.CalculationType==8}).length>0)){this.model.pivotControl._createErrorDialog(this.model.pivotControl._getLocalizedLabels("CalcValue"),this.model.pivotControl._getLocalizedLabels("Warning"));return}h=t.isNullOrUndefined(r.event)?"":this._setSplitBtnTargetPos(r.event);try{a=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(st){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(a=this.model.pivotControl.getOlapReport())}if(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(this.model.pivotControl.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"}),rt=u=="schemaFilter"&&this.model.pivotControl._getNodeByUniqueName(e)!=null&&this.model.pivotControl._getNodeByUniqueName(e).find(".namedSetCDB").length>0,b=n(r.element.parent()).attr("tag").split(":")[0]=="Columns"&&this._droppedClass=="schemaColumn"&&s.toLowerCase()=="measures"||n(r.element.parent()).attr("tag").split(":")[0]=="Rows"&&this._droppedClass=="schemaRow"&&s.toLowerCase()=="measures",b||rt||e.toLowerCase().indexOf("[measures]")>=0&&u!="schemaValue"||u=="schemaValue"&&!(e.toLowerCase().indexOf("[measures]")>=0)||u=="schemaFilter"&&e.toLowerCase().indexOf("measures")>=0)return this._waitingPopup.hide(),b||this._createErrorDialog(),r.Cancel;if(e.toLowerCase().indexOf("measures")>=0&&!(e.toLowerCase().indexOf("[measures]")>=0))return n(r.element.parent().parent()).remove(),this.model.pivotControl.model.dataSource.values[0].axis=u=="schemaRow"?"rows":u=="schemaColumn"?"columns":"columns",this._createPivotButton({fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")},u=="schemaRow"?"row":u=="schemaColumn"?"column":"column","","",h),t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl),this._waitingPopup.hide(),this._setPivotBtnWidth(),!1}if(this.model.pivotControl._dataModel=="Pivot"&&u!="schemaValue"&&n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==e}).length>0){alert(this.model.pivotControl._getLocalizedLabels("CalcValue"));return}if(n(r.element.parent().parent()).remove(),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(it=this._currentCubeName+"--"+s+"--"+v+"--"+h,this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),l=JSON.stringify({action:"nodeDropped",dropType:"SplitButton",nodeInfo:it,currentReport:a,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l.replace("nodeDropped","nodeDroppedDeferUpdate"),this._droppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l,this._droppedSuccess)):(this._createPivotButton({fieldName:r.element.attr("fieldName"),fieldCaption:r.element.attr("fieldCaption")},u=="schemaRow"?"row":u=="schemaColumn"?"column":u=="schemaFilter"?"filter":u=="schemaValue"?"value":"",y,w,h),!t.isNullOrUndefined(this.model.pivotControl._calculatedField)&&this.model.pivotControl._calculatedField.length>0&&u!="schemaValue"&&this.model.pivotControl._calculatedFieldNodeRemove(s),this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),k="",k=t.Pivot._getFilterParams(u,this._tempFilterData,e),l=JSON.stringify({action:"nodeDropped",dropAxis:u+"::"+h,filterParams:k,headerTag:JSON.stringify(s),sortedHeaders:this.model.pivotControl._ascdes,currentReport:a,valueSorting:JSON.stringify(this.model.pivotControl.model.valueSortSettings),customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),et=this.model.pivotControl._renderControlSuccess,this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l,this._pvtNodeDroppedSuccess));else{if(f=this.model.pivotControl._getDroppedItem(e),d={},f.length>0&&(d=f[0].isNamedSets!=i?{fieldName:f[0].fieldName,fieldCaption:f[0].fieldCaption,isNamedSets:f[0].isNamedSets}:{fieldName:f[0].fieldName,fieldCaption:f[0].fieldCaption}),g=u=="schemaRow"?"row":u=="schemaColumn"?"column":u=="schemaFilter"?"filter":u=="schemaValue"?"value":"",this._createPivotButton(d,g,y,w,h),n.isNumeric(h)?u=="schemaRow"?this.model.pivotControl.model.dataSource.rows.splice(h,0,f[0]):u=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.splice(h,0,f[0]):u=="schemaValue"?this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.pivotControl.model.dataSource.values[0].measures.splice(h,0,f[0]):this.model.pivotControl.model.dataSource.values.splice(h,0,f[0]):this.model.pivotControl.model.dataSource.filters.splice(h,0,f[0]):u=="schemaRow"?this.model.pivotControl.model.dataSource.rows.push(f[0]):u=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.push(f[0]):u=="schemaValue"?this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.pivotControl.model.dataSource.values[0].measures.push(f[0]):this.model.pivotControl.model.dataSource.values.push(f[0]):this.model.pivotControl.model.dataSource.filters.push(f[0]),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl._calculatedField.length>0&&u!="schemaValue"){for(ut=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return t.isNullOrUndefined(n.isCalculatedField)||n.isCalculatedField==!1||n.isCalculatedField==!0&&n.formula.indexOf(f[0].fieldName)==-1}),nt=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.isCalculatedField==!0&&n.formula.indexOf(f[0].fieldName)>-1}),o=0;o<nt.length;o++)this._tableTreeObj.uncheckNode(nt[o].fieldName);this.model.pivotControl.model.dataSource.values=ut}this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(ft=this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns:":"Rows:",tt=this.element.find("div[tag='"+ft+"Measures']:first"),tt.appendTo(tt.parent()),ot=r.element.attr("axis").toLowerCase(),this.model.pivotControl.model.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"}));this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(this._trigger("fieldItemDropped",{axis:g,fieldItem:f}),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}}else this._removePvtBtn(r);this._setPivotBtnWidth()},_createErrorDialog:function(){if(t.Pivot.openPreventPanel(this),this.element.find(".errorDialog").length==0){var n=t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent",this._getLocalizedLabels("AlertMsg"))[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title",this._getLocalizedLabels("Warning"))[0].outerHTML;this.element.append(n);this.element.find(".errorDialog").ejDialog({target:"#"+this._id,enableResize:!1,enableRTL:this.model.enableRTL,width:"400px",close:t.proxy(t.Pivot.closePreventPanel,this)});this._errorDialog=this.element.find(".errorDialog").data("ejDialog");this.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this._errOKBtnClick,this)});this.element.find(".e-dialog .e-close").attr("title",this._getLocalizedLabels("Close"))}else this._errorDialog.open()},_errOKBtnClick:function(){t.Pivot.closePreventPanel(this);this._errorDialog._ejDialog.find("div.e-dialog-icon").trigger("click")},_hideSchemaDesigner:function(){n("#"+this._id).animate({left:"-"+n("#"+this._id).width()+"px"},500,function(){});this.element.find(".collapseSchema").addClass("expandSchema").removeClass("collapseSchema")},_showSchemaDesigner:function(){n("#"+this._id).animate({left:"5px"});this.element.find(".expandSchema").addClass("collapseSchema").removeClass("expandSchema")},_reSizeHandler:function(){var f,e,c,i,o,r,u,s,h;this.model.pivotControl&&(f=n("#"+this._id).width(),this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?(this.element.find(".axisTd1, .axisTd2").css({width:"100%"}),this._pivotClientObj.model.isResponsive||(e=this._pivotClientObj.element.find("#"+this._id).width()/2,this._pivotClientObj.element.find("div.fieldTable").width(e-6),this._pivotClientObj.element.find("div.axisTable").width(e-5)),this._pivotClientObj.model.isResponsive&&this._pivotClientObj.element.find("div.axisTable").css({width:"52%"})):(this.element.find("div.axisTable").width(f),c=(f-2)/2,this.element.find(".axisTd1, .axisTd2").css({width:c})),i=t.PivotSchemaDesigner.Layouts.OneByOne==this.model.layout?this._pivotClientObj.element.find(".controlPanel").height()-15:25/100*n("#"+this._id).height(),this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&(i=this.element.find(".cubelists").length>0?i-27:i+5),this.element.find("div.parentSchemaFieldTree, .schemaFieldTree, div.fieldTable").height(i),this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&this.element.find("div.schemaFieldTree").height(i-35),n(this.element).parents(".e-pivotclient").length>0||(n("#"+this._id).height()<450&&n("#"+this._id).css("min-height","450px"),n("#"+this._id).width()<240&&n("#"+this._id).css("min-width","240px")),u=n(this.element).parents(".e-pivotclient").length>0?this._pivotClientObj.element.find(".controlPanel").height()-10:n("#"+this._id).height()+20,s=t.PivotSchemaDesigner.Layouts.OneByOne==this.model.layout?0:this.element.find("table.headerTable").height()+this.element.find("div.fieldTable").height()+this.element.find("div.centerDiv").height()+this.element.find("div.centerHead").height(),o=this.model.pivotControl==null||this.model.pivotControl.element.hasClass("e-pivotclient")||this.model.pivotControl.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode?t.PivotSchemaDesigner.Layouts.OneByOne==this.model.layout?u:u-(s+80):u-(s+105),this.element.find("div.axisTable").height(o),r=o/(this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?4:2),this.element.find(".axisTd1,.axisTd2").css({height:r}),n(this.element).parents(".e-pivotclient").length>0&&(this._pivotClientObj.element.find(".schemaColumn, .schemaValue").height(r-28),this._pivotClientObj.element.find(".schemaRow, .schemaFilter").height(r-28)),this._setPivotBtnWidth(),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(h=n(".schemaFieldTree ul>li div").width(),n(n(".e-pivotschemadesigner .schemaFieldTree.e-treeview .e-text")).each(function(){var t=(h-50)/h*100;n(this).width(t.toString()+"%")})))},_clientDialogBtnClick:function(i){var f=[],y=[],r=this.model.pivotControl,tt=this._selectedFieldName,p={},b=this,s=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,l,g,nt,e,c,v,h,u;if(this.element.find(".e-dialog, .clientDialog").hide(),this.element.find("#preventDiv").remove(),i.model.text.toLowerCase()!="cancel"){if(t.isNullOrUndefined(s)?r._waitingPopup.show():(s._isTimeOut=!0,setTimeout(function(){s._isTimeOut&&b.model.pivotControl._waitingPopup.show()},800)),r.model.analysisMode==t.Pivot.AnalysisMode.Olap){r.element.hasClass("e-pivotclient")&&!t.isNullOrUndefined(r._pivotChart)&&(r._pivotChart._labelCurrentTags={});t.olap.base.clearDrilledItems(r.model.dataSource,{action:"filtering"},r);this._memberTreeObj=t.Pivot.updateTreeView(this);var e=this._selectedFieldName,c=r.model.dataSource,o={};r._currentReportItems=n.map(r._currentReportItems,function(n){return n.fieldName==e&&(t.isNullOrUndefined(n.dataSrc)||n.dataSrc.cube==c.cube&&n.dataSrc.reportName==c.reportName)&&(o=n.filterItems,n.filterItems=b._memberTreeObj.dataSource()),n});p=t.Pivot.getNodesState(!t.isNullOrUndefined(r)&&r.model.enableMemberEditorPaging?this._editorTreeData:this._memberTreeObj);var w=t.Pivot._getEditorMember(e.toLocaleLowerCase(),r,!0),k="selectedNodes",d="include",a=r.model.dataSource.providerName=="mondrian";if(r._fieldSelectedMembers[e.toLocaleLowerCase()]=n.map(r._fieldMembers[e.toLocaleLowerCase()],function(n){if(!n.checked)return n}).length==0?"All":w!="All"&&w!="multiple"?w:r._getLocalizedLabels("MultipleItems"),u=t.Pivot.getReportItemByFieldName(this._selectedFieldName,r.model.dataSource,this._dataModel).item,a&&(k="unSelectedNodes",d="exclude"),f=n.map(p[k].split("::"),function(n){return{Id:n.split("||")[0],tag:n.split("||")[1],parentId:n.split("||")[2]}}),!t.isNullOrUndefined(r._selectedNodes))for(l=0;l<r._selectedNodes.length;l++)g=r._selectedNodes[l],nt=n.map(f,function(n){if(g.tag==n.tag)return n}),nt.length==0&&f.push(r._selectedNodes[l]);if(t.isNullOrUndefined(u)||(u.advancedFilter=[],u.filterItems={filterType:d,values:t.Pivot.removeParentSelectedNodes(f)},this._selectedTreeNode=this.element.find(".schemaFieldTree").find("li[tag='"+u.fieldName+"']"),n(this._selectedTreeNode).parents("li:eq(0) span:eq(0)").hasClass("hierarchyCDB")&&(this._selectedTreeNode=n(this._selectedTreeNode).parents("li:eq(0)")),p.unSelectedNodes!=""?(a||(r.model.dataSource=t.olap.base.clearDrilledItems(r.model.dataSource,{action:"filtering"},r)),n(this._selectedTreeNode).find(".filter").length<=0&&(n(n(this._selectedTreeNode).find(".e-text")[0]).after(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filtered").addClass("filter")[0].outerHTML),this.element.find(".pivotButton:contains('"+this._selectedFieldName+"') .filter").addClass("filtered"),this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").addClass("filtered"))):r._unSelectedNodes?(a||(r.model.dataSource=t.olap.base.clearDrilledItems(r.model.dataSource,{action:"filtering"},r)),n(this._selectedTreeNode).find(".filter").length<=0&&(n(n(this._selectedTreeNode).find(".e-text")[0]).after(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filtered").addClass("filter")[0].outerHTML),this.element.find(".pivotButton:contains('"+this._selectedFieldName+"') .filter").addClass("filtered"),this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").addClass("filtered"))):(this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").removeClass("filtered"),this._selectedTreeNode.find(".filter").remove(),delete u.filterItems)),r.model.analysisMode==t.Pivot.AnalysisMode.Olap&&r.model.operationalMode==t.Pivot.OperationalMode.ClientMode){if(e=this._selectedFieldName,c=r.model.dataSource,r._currentReportItems=n.map(r._currentReportItems,function(n){if(n.fieldName!=e&&(t.isNullOrUndefined(n.dataSrc)||n.dataSrc.cube==c.cube&&n.dataSrc.reportName==c.reportName))return n}),o=r.model.enableMemberEditorPaging?this._editorTreeData:n.extend([],this._memberTreeObj.dataSource()),a){for(v=2,h=0;h<o.length;h++)!t.isNullOrUndefined(o[h].level)&&o[h].level>v&&(v=o[h].level);r.model.dataSource._maxLevel=v}r._currentReportItems.push({filterItems:o,fieldName:e,dataSrc:r.model.dataSource,pageSettings:this._memberCount})}t.olap.base.getJSONData({action:"filtering"},r.model.dataSource,r)}else t.PivotAnalysis._valueSorting=null,this.model.pivotControl.model.enableMemberEditorPaging?(jQuery.each(this._editorTreeData,function(n,t){t.name!="All"&&t.checkedStatus&&f.push(t.name)}),jQuery.each(this._editorTreeData,function(n,t){t.checkedStatus||y.push(t.name=t.name=="(blank)"?"":t.name)})):(jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:checked"),function(n,t){t.value!="All"&&f.push(t.value)}),jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:not(:checked)"),function(n,t){y.push(t.value=t.value=="(blank)"?"":t.value)})),this._selectedFieldName&&(u=u=t.Pivot.getReportItemByFieldName(this._selectedFieldName,r.model.dataSource,this._dataModel).item,u&&(u.advancedFilter=[])),this._pivotFilterItems(f,y),this.model.pivotControl.refreshControl();this._refreshPivotButtons();r._isMemberPageFilter=!0;t.isNullOrUndefined(s)||s._isTimeOut&&(s._isTimeOut=!1)}},_pivotFilterItems:function(i,r){var h=this.model.pivotControl.model.dataSource[this._selectedFieldAxis],e=t.PivotAnalysis.getMembers(this._selectedFieldName),o,f,u,s;for(jQuery.each(e,function(n,t){t!=null&&t.toString().replace(/^\s+|\s+$/gm,"")||jQuery.each(r,function(n,i){i.toString().replace(/^\s+|\s+$/gm,"")||(r[n]=t)})}),o=this._selectedFieldName,f=n.grep(h,function(n){return n.fieldName==o}),u=0;u<f.length;u++)f[u].filterItems=i.length==e.length?null:{filterType:t.PivotAnalysis.FilterType.Exclude,values:r};r.length>0&&this.element.find(".schemaFieldTree li[id='"+this._selectedFieldName+"']").find(".filter").length<=0?(s=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,this.element.find(".schemaFieldTree li[id='"+this._selectedFieldName+"']").find(".e-text").after(s),this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").addClass("filtered")):r.length==0&&(this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").removeClass("filtered"),this.element.find(".schemaFieldTree li[id='"+this._selectedFieldName+"']").find(".filter").remove())},_dialogBtnClick:function(r){var k,f,l,d,nt,v,o,tt,g,it,c,b,u,ut,a,ft;if(t.Pivot.closePreventPanel(this),this.element.find(".e-dialog, .clientDialog").hide(),k=this,f=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,!this._isFiltered)return!1;if(this.model.pivotControl._isUpdateRequired=!0,this.model.pivotControl!=null&&(this.model.pivotControl._memberTreeObj=this._memberTreeObj),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(r.model.text.toLowerCase()=="cancel")return;l=[];d=[];this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(nt=this._selectedMember,this.model.pivotControl._currentReportItems=n.grep(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()!=nt.toLocaleLowerCase())return n}),this._memberTreeObj=t.Pivot.updateTreeView(this),this.model.pivotControl._currentReportItems.push({filterItems:n.extend([],this._memberTreeObj.dataSource()),fieldName:this._selectedMember}),l=n.map(this.model.pivotControl._getSelectedNodes().split("::"),function(n){return{Id:n.split("||")[0],tag:n.split("||")[1],parentId:n.split("||")[2]}}),v=this._selectedMember!=i?this._selectedMember.toLocaleLowerCase():this._selectedMember.toLocaleLowerCase(),o=n.map(this.model.pivotControl.model.dataSource.columns,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==v)return n}),o.length==0&&(o=n.map(this.model.pivotControl.model.dataSource.rows,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==v)return n})),o.length==0&&(o=n.map(this.model.pivotControl.model.dataSource.filters,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==v)return n})),o.length>0&&(this._getUnSelectedNodes()!=""&&(this.model.pivotControl.model.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"filtering"})),o[0].advancedFilter=[],o[0].filterItems={filterType:"include",values:this.model.pivotControl._removeSelectedNodes(l)},this._selectedTreeNode=this.element.find(".schemaFieldTree").find("li[tag='"+o[0].fieldName+"']"),n(this._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("hierarchyCDB")&&(this._selectedTreeNode=n(n(this._selectedTreeNode).parents("li:eq(0)"))),this._getUnSelectedNodes()==""?(this._selectedTreeNode.find(".filter").remove(),this.element.find(".pvtBtn[fieldname='"+this._selectedMember+"']").parent().find(".filter").removeClass("filtered"),delete o[0].filterItems):n(n(this._selectedTreeNode)).find(".filter").length<=0&&(n(n(this._selectedTreeNode).find(".e-text")[0]).after(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filtered").addClass("filter")[0].outerHTML),this.element.find(".pvtBtn[fieldname='"+this._selectedMember+"']").parent().find(".filter").addClass("filtered"))),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||(t.isNullOrUndefined(f)?this.model.pivotControl._waitingPopup.show():(f._isTimeOut=!0,setTimeout(function(){f._isTimeOut&&k.model.pivotControl._waitingPopup.show()},800))),t.olap.base.getJSONData({action:"filtering"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(t.PivotAnalysis._valueSorting=null,jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:checked"),function(n,t){t.value!="All"&&l.push(t.value)}),jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:not(:checked)"),function(n,t){d.push(t.value=t.value=="(blank)"?"":t.value)}),this.element.find(".e-dialog, .clientDialog").hide(),this.model.pivotControl._pivotFilterItems(l,d),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}else{if(tt="",it=this.element.find(".editorTreeView :input.nodecheckbox"),r.model.text.toLowerCase()!="cancel"){var e=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?tt=this._getUnSelectedNodes()+"FILTERED"+this._getSelectedNodes(this._curFilteredAxis=="schemaFilter"?!0:!1):this.model.pivotControl.model.enableMemberEditorPaging?this._editorTreeData:this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),y=!1,s=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.pivotControl.model.enableMemberEditorPaging?t.Pivot._getUnSelectedTreeState(this)+"FILTERED"+t.Pivot._getSelectedTreeState(this._curFilteredAxis=="schemaFilter"?!0:!1,this):e:this._curFilteredAxis+"::"+this._curFilteredText+"::FILTERED",h=this._curFilteredText,p=[],w={};if(g=this.model.pivotControl.model.enableMemberEditorPaging?t.Pivot._getUnSelectedTreeState(this)!=""?!0:!1:this._getUnSelectedNodes()!=""?!0:!1,this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot){for(t.isNullOrUndefined(this.model.pivotControl._fieldMembers[h])&&(this.model.pivotControl._fieldMembers[h]=t.Pivot._getEditorMember(it,this.model.pivotControl,!0)),u=0;u<e.length;u++)this.model.pivotControl.model.enableMemberEditorPaging?e[u].checkedStatus==!1&&p.push(e[u].name):p.push(n(e[u].parentElement).siblings("a").text());for(w[h]=p,c=this.element.parents(".e-pivotclient").length>0?this.model.pivotControl._tempFilterData:this._tempFilterData,t.isNullOrUndefined(c)&&(c=[]),u=0;u<c.length;u++)t.isNullOrUndefined(c[u][h])||(c[u][h]=p,y=!0);if(y||c.push(w),this._tempFilterData=this.model.pivotControl._tempFilterData=c,(t.isNullOrUndefined(this._curFilteredAxis)||this._curFilteredAxis!="")&&this._curFilteredAxis!="schemaValue")for(u=0;u<e.length;u++)this.model.pivotControl.model.enableMemberEditorPaging?e[u].checkedStatus==!1&&(s+="##"+e[u].name):s+="##"+n(e[u].parentElement).siblings("a").text()}else{for(b=t.Pivot._getEditorMember(h,this.model.pivotControl,!0),this.model.pivotControl._fieldSelectedMembers[h]=n.map(this.model.pivotControl._fieldMembers[h],function(n){if(!n.checked)return n}).length==0?"All":b!="All"&&b!="multiple"?b:this.model.pivotControl._getLocalizedLabels("MultipleItems"),w[this._curFilteredText]=s,t.isNullOrUndefined(this.model.pivotControl._tempFilterData)&&(this.model.pivotControl._tempFilterData=[]),u=0;u<this.model.pivotControl._tempFilterData.length;u++)t.isNullOrUndefined(this.model.pivotControl._tempFilterData[u][this._curFilteredText])||(this.model.pivotControl._tempFilterData[u][this._curFilteredText]=s,y=!0);y||this.model.pivotControl._tempFilterData.push(w)}var rt=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this._curFilteredText:this._curFilteredText.split(".")[1],et=this._getSortedHeaders(),ot=this.model.layout=="excel"?this.element.find(".schemaFieldTree li:contains('"+this._curFilteredText+"')"):this.element.find("."+this._curFilteredAxis+" .pivotButton:contains("+this._curFilteredText+") .filterBtn");if((this.model.layout=="excel"||this.model.layout=="normal")&&(n(this._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("hierarchyCDB")&&(this._selectedTreeNode=n(n(this._selectedTreeNode).parents("li:eq(0)"))),g&&n(n(this._selectedTreeNode)).find(".filter").length<=0?(ut=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,n(n(this._selectedTreeNode).find(".e-text")[0]).after(ut),this.element.find(".pvtBtn:contains('"+rt+"')").parent().find(".filter").addClass("filtered")):g||(n(this._selectedTreeNode).find(".filter").remove(),this.element.find(".pvtBtn:contains('"+rt+"')").parent().find(".filter").removeClass("filtered")),this._curFilteredAxis==""))return!1;this.model.pivotControl.model.enableGroupingBar&&(n.each(this.model.pivotControl.element.find(".pivotButton .filter"),function(t,i){n(i).removeClass("filtered")}),(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?e.length>0:e.split("FILTERED::")[0].length>0)&&this.model.pivotControl.element.find("#pivotButton"+this._curFilteredText.split(".")[0]).next().addClass("filtered"));try{a=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(st){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(a=this.model.pivotControl.getOlapReport())}this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.pivotControl.model.customObject});ft=this.model.pivotControl.model.customObject!={}&&s!=""?JSON.stringify({action:"filtering",filterParams:s+(this.model.pivotControl&&n(this.model.pivotControl.element).hasClass("e-pivotclient")&&!t.isNullOrUndefined(this.model.pivotControl._ascdes)&&this.model.pivotControl.model.enableAdvancedFilter?">>#>#>>"+this.model.pivotControl._ascdes:""),sortedHeaders:this.model.pivotControl._ascdes,currentReport:a,valueSorting:this.model.pivotControl.model.valueSortSettings,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}):this.model.pivotControl.model.customObject!={}?JSON.stringify({action:"filtering",currentReport:a,valueSorting:this.model.pivotControl.model.valueSortSettings,customObject:serializedCustomObject}):s!=""?JSON.stringify({action:"filtering",filterParams:s,sortedHeaders:this.model.pivotControl._ascdes,currentReport:a,valueSorting:this.model.pivotControl.model.valueSortSettings}):JSON.stringify({action:"filtering",valueSorting:this.model.pivotControl.model.valueSortSettings});t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||(t.isNullOrUndefined(f)?this.model.pivotControl._waitingPopup.show():(f._isTimeOut=!0,setTimeout(function(){f._isTimeOut&&k.model.pivotControl._waitingPopup.show()},800)));this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.pivotControl.model.enableDeferUpdate?(this.model.pivotControl._filterUpdate.push(s),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||(t.isNullOrUndefined(f)||(f._isTimeOut=!1),this.model.pivotControl._waitingPopup.hide()),this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.filtering,ft,this._filterElementSuccess)}this._selectedTreeNode=null;this._refreshPivotButtons()}t.isNullOrUndefined(f)||f._isTimeOut&&(f._isTimeOut=!1)},_beforeNodeExpand:function(n){t.Pivot.getChildNodes(n,this._selectedFieldName,this.model.pivotControl._currentReportItems,this.model.pivotControl.model.dataSource,this)},_nodeExpand:function(n){this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl._nodeExpand(n)},_nodeStateModifiedSuccess:function(n){this.model.pivotControl._isUpdateRequired=!0;n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});this.model.pivotControl.model.enableDeferUpdate?this.model.pivotControl._deferUpdateSuccess(n):this.model.pivotControl._renderControlSuccess(n);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_pvtNodeDroppedSuccess:function(r){r[0]!=i?r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value):r.d!=i?(r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value),r.d[0].Key=="PivotReport"&&this.model.pivotControl.setOlapReport(r.d[0].Value)):(r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject),this.model.pivotControl.setOlapReport(r.PivotReport));this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});this.model.pivotControl.model.enableDeferUpdate?this.model.pivotControl._deferUpdateSuccess(r):n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(this.model.pivotControl.refreshControl(r),this.model.pivotControl&&this.model.pivotControl._pivotGrid&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl._pivotGrid._removeCells(r)):this.model.pivotControl._renderControlSuccess(r);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_pvtBtnDroppedSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject});this.model.pivotControl._renderControlSuccess(n);this.model.pivotControl&&this.model.pivotControl._pivotGrid&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl._pivotGrid._removeCells(n);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_filterElementSuccess:function(r){var u,f,e;n(this.element).parents(".e-pivotclient").length>0?(t.isNullOrUndefined(r.d)||(u={},u.PivotReport=r.d[0].Value,u.GridJSON=r.d[1].Value,u.ChartJSON=r.d[2].Value,f=n.map(r.d,function(n){if(n.Key=="FilteredColumnHeaders")return n.Value}),f.length>0&&(u.FilteredColumnHeaders=f[0]),e=n.map(r.d,function(n){if(n.Key=="FilteredRowHeaders")return n.Value}),e.length>0&&(u.FilteredRowHeaders=e[0]),r=u),this.model.pivotControl.refreshControl(r),this.model.pivotControl&&this.model.pivotControl._pivotGrid&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl._pivotGrid._removeCells(r)):(r[0]!=i?r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value):r.d!=i?r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value):r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject),this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject}),this.model.pivotControl._renderControlSuccess(r));this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style");t.Pivot.closePreventPanel(this);this.element.find(".e-dialog").remove()},_fetchChildNodeSuccess:function(r){var u,f,e;r.length>1&&r[0]!=i?(u=JSON.parse(r[0].Value),r[1]!=null&&r[1]!=i&&(this.model.customObject=r[1].Value)):r.d!=i?(u=JSON.parse(r.d[0].Value),r.d[1]!=null&&r.d[1]!=i&&(this.model.customObject=r.d[1].Value)):(u=JSON.parse(r.ChildNodes),r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject));e={id:"id",parentId:"pid",hasChild:"hasChildren",text:"name",isChecked:"checkedStatus"};f=n(this.pNode).parents("li").length>1?n(this.pNode).parents("li").first():n(this.pNode).parents("li");n(n(f).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});this._memberTreeObj._createSubNodesWhenLoadOnDemand(u,this.pNode,e);n.each(n(f).children().find("li"),function(n,t){t.setAttribute("tag",u[n].tag)});this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject});this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_fetchMemberSuccess:function(r){if(r[0]!=i&&r.length>0?(this._currentMembers=r[0].Value,r[1]!=null&&r[1]!=i&&(this.model.customObject=r[1].Value)):r.d!=i&&r.d.length>0?(this._currentMembers=r.d[0].Value,r.d[1]!=null&&r.d[1]!=i&&(this.model.customObject=r.d[1].Value)):r!=i&&r.length>0?(this._currentMembers=r.EditorTreeInfo,r!=null&&r.customObject!=i&&(this.model.customObject=r.customObject)):r!=i&&(this._currentMembers=r.EditorTreeInfo,r!=null&&r.customObject!=i&&(this.model.customObject=r.customObject)),this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject}),this._createDialog(this._dialogHead,this._currentMembers),this.model.pivotControl._waitingPopup){var u=n(this.element).parents(".e-pivotclient").length>0?n(this.element).parents(".e-pivotclient").data("ejPivotClient"):null;t.isNullOrUndefined(u)||(u._isTimeOut=!1);this.model.pivotControl._waitingPopup.hide()}this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style");t.isNullOrUndefined(this.element.find(".e-dialog .e-text:visible").first())||this.element.find(".e-dialog .e-text:visible").first().attr("tabindex","-1").focus().addClass("hoverCell")},_droppedSuccess:function(r){var u=null;this.model.pivotControl.model.enableDeferUpdate?u=this._removeButtonDeferUpdate==!1?t.isNullOrUndefined(r.OlapReport)?JSON.parse(r.d[0].Value):JSON.parse(r.OlapReport):u=t.isNullOrUndefined(r.OlapReport)?r.d[0].Value:r.OlapReport:(!t.isNullOrUndefined(r[0])&&r.length>0?(u=JSON.parse(r[1].Value),r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value)):!t.isNullOrUndefined(r.d)&&r.d.length>0?(u=n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?JSON.parse(n.grep(r.d,function(n){return n.Key=="PivotReport"})[0].Value):JSON.parse(r.d[1].Value),r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value)):t.isNullOrUndefined(r)||t.isNullOrUndefined(r.OlapReport)?t.isNullOrUndefined(r)||t.isNullOrUndefined(r.PivotReport)||(u=JSON.parse(r.PivotReport)):u=JSON.parse(r.OlapReport),r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject));this._removeButtonDeferUpdate==!1&&(this.element.find(".axisTable .pivotButton").remove(),this._setPivotRows(u.PivotRows),this._setPivotColumns(u.PivotColumns),this._setPivotCalculations(u.PivotCalculations),this._setFilters(u.Filters),this.model.pivotControl.setOlapReport(JSON.stringify(u)),this._refreshPivotButtons(),this.model.enableDragDrop&&this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)}),this._unWireEvents(),this._wireEvents());this.model.pivotControl.model.enableDeferUpdate?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide(),t.isNullOrUndefined(r.OlapReport)?(this.model.pivotControl.setOlapReport(r.d[0].Value),n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=i&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(r.d[2].Value),JSON.parse(r.d[1].Value))):(this.model.pivotControl.setOlapReport(r.OlapReport),r.HeaderCounts!=i&&n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=i&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(r.HeaderCounts),JSON.parse(r.PageSettings))),this._removeButtonDeferUpdate=!1,this.model.pivotControl._deferUpdateSuccess(r)):n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(this.model.pivotControl.refreshControl(r),this.model.pivotControl&&this.model.pivotControl._pivotGrid&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl._pivotGrid._removeCells(r)):this.model.pivotControl._renderControlSuccess(r);this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style");this._createContextMenu();this._setPivotBtnWidth()},_removePvtBtn:function(i){var f,u,o,e,s,r;this.model.pivotControl._waitingPopup.show();n(i.element).length>0?(f=n(i.element).parent().attr("tag").split(":")[1],u=n(i.element).parent().attr("tag")):(f=n(i.target).parent().attr("tag").split(":")[1],u=n(i.target).parent().attr("tag"));try{o=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(h){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(o=this.model.pivotControl.getOlapReport())}if(o==""&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(o=this.model.pivotControl.model.dataSource),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap)if(this._clearFilterData(f),e=u.indexOf("[Measures]")>-1||u.indexOf("[")>-1?u.split(":")[1]:this.model.pivotControl._getNodeUniqueName(u),e=e.indexOf("<>")?e.replace("<>","."):e,e=="[Measures]"){if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)t.Pivot.removeReportItem(this.model.pivotControl.model.dataSource,f,f.toLocaleLowerCase().indexOf("measures")==0),this.model.pivotControl.refreshControl(),this.refreshControl();else if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){for(n(i.element).length>0?n(i.element).parent().parent().remove():n(i.target).parent().parent().remove(),r=0;r<this.model.pivotCalculations.length&&u.indexOf(this._getLocalizedLabels("Measures"))>-1;r++)e=this.model.pivotCalculations[r].Tag,this._isMeasureBtnRemove=!0,selectedTreeNode=this.model.pivotControl._getNodeByUniqueName(e),this._tableTreeObj.uncheckNode(selectedTreeNode);this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.pivotControl.model.customObject});s=JSON.stringify({action:"removeButton",headerInfo:u,currentReport:o,customObject:JSON.stringify(this.model.pivotControl.model.customObject),gridLayout:this.model.pivotControl.model.layout});u.indexOf("[Measures]")<0&&u.indexOf("Measures")>=0&&this.element.find(".schemaValue .pivotButton").remove();this.model.pivotControl.model.enableDeferUpdate?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,s.replace("removeButton","removeButtonDeferUpdate"),this._droppedSuccess),this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,s,this._pvtBtnDroppedSuccess)}}else selectedTreeNode=this.model.pivotControl._getNodeByUniqueName(e),this._tableTreeObj.uncheckNode(selectedTreeNode);else if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(t.PivotAnalysis._valueSorting=null,f=n(i.element).length>0?n(i.element).parent().find(".pvtBtn").attr("fieldname"):n(i.target).parent().find(".pvtBtn").attr("fieldname"),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap){if(u.split(":")[1].toLowerCase()=="measures"){for(this.model.pivotControl._ogridWaitingPopup.show(),this.element.find("div[tag='"+u+"']").remove(),r=0;r<this.model.pivotControl.model.dataSource.values[0].measures.length;r++)this._nodeCheck=!0,selectedTreeNode=this._tableTreeObj.element.find("li[tag='"+this.model.pivotControl.model.dataSource.values[0].measures[r].fieldName+"']"),this._tableTreeObj.uncheckNode(selectedTreeNode),this.element.find("div[tag='values:"+this.model.pivotControl.model.dataSource.values[0].measures[r].fieldName+"']").remove();this.model.pivotControl.model.dataSource.values[0].measures=[];t.olap.base.getJSONData({action:"removeButton"},this.model.pivotControl.model.dataSource,this.model.pivotControl)}if(selectedTreeNode=this._tableTreeObj.element.find("li[tag='"+f+"']"),selectedTreeNode.length>1)for(r=0;r<selectedTreeNode.length;r++)this._tableTreeObj.isNodeChecked(selectedTreeNode[r])&&(selectedTreeNode=selectedTreeNode[r])}else selectedTreeNode=this._tableTreeObj.element.find("li[id="+f+"]");this._tableTreeObj.uncheckNode(selectedTreeNode)}else selectedTreeNode=this._tableTreeObj.element.find("li:contains('"+f+"')"),this._tableTreeObj.uncheckNode(selectedTreeNode)},_createDialog:function(i,r){var s,nt,h,c,o,l,y,tt,p,u,rt,a,b;this.element.find(".e-dialog, .clientDialog").remove();var v,f,k="",d="",g="",e=this.model.pivotControl&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl.model.enableAdvancedFilter&&this._curFilteredAxis!="schemaFilter"&&this._curFilteredAxis!="schemaValue"||this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.dataSource.enableAdvancedFilter&&t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource,this._dataModel).axis!="filters"&&t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource,this._dataModel).axis!="values"&&!t.isNullOrUndefined(t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource,this._dataModel).item)?!0:!1;e&&(s=JSON.parse(r),s[0].name="(Select All)",v=this._selectedFieldName,this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?(f=n.map(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName==v)return n.dropdownData}),f.length==0&&(f=n.map(this._tableTreeObj.element.find("li[tag ='"+this._selectedFieldName+"'] li"),function(t){return{value:n(t).attr("tag"),text:n(t).find("a").text()}}))):f=[{value:this._selectedFieldName,text:this._selectedFieldName}]:this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?(f=this.model.pivotControl.model.enableMemberEditorPaging?this._memberPagingAvdData:s.splice(s.length-1,1),f=JSON.parse(f[0].levels)):f=[{value:this._curFilteredText,text:this._curFilteredText}],r=JSON.stringify(s),k=t.buildTag("div.ddlGroupWrap",this._getLocalizedLabels("SelectField")+":"+t.buildTag("input#"+this._id+"_GroupLabelDrop.groupLabelDrop").attr("type","text")[0].outerHTML,{})[0].outerHTML,d=t.buildTag("ul.filterElementTag")[0].outerHTML,nt=t.Pivot.createAdvanceFilterTag({action:"filterTag"},this));g=t.buildTag("div.memberSearchEditorDiv",t.buildTag("input#"+this._id+"_SearchEditorTreeView.searchEditorTreeView").attr("type","text")[0].outerHTML+(this.model.pivotControl.model.enableMemberEditorPaging&&n.parseJSON(r).length>=this.model.pivotControl.model.memberEditorPageSize?t.buildTag("span.e-icon searchEditorTree",{})[0].outerHTML:""),{padding:this.model.pivotControl.model.enableAdvancedFilter?"5px 5px 0px 9px":0})[0].outerHTML;var ut=t.buildTag("div#"+this._id+"_EditorDiv.editorDiv",k+d+t.buildTag("div",g+t.buildTag("div.memberEditorDiv",t.buildTag("div#editorTreeView.editorTreeView")[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML+(!t.isNullOrUndefined(r)&&this.model.pivotControl.model.enableMemberEditorPaging&&(n.parseJSON(r).length>=this.model.pivotControl.model.memberEditorPageSize||this.model.pivotControl.model.memberEditorPageSize<this._memberPageSettings.endPage)?"":"<\/br>"),ft=t.buildTag("div",t.buildTag("button#"+this._id+"_OKBtn.dialogOKBtn",this._getLocalizedLabels("OK"))[0].outerHTML+t.buildTag("button#CancelBtn.dialogCancelBtn",this._getLocalizedLabels("Cancel"))[0].outerHTML,{float:"right",margin:(!t.isNullOrUndefined(r)&&n.parseJSON(r).length>=this.model.pivotControl.model.memberEditorPageSize?"10px":"-5px ")+" "+(e?" 5px ":" 0px ")+" 6px 0px"})[0].outerHTML,et=t.buildTag("div.memberPager",t.buildTag("div#"+this._id+"_NextpageDiv.nextPageDiv",t.buildTag("div.e-icon e-media-backward_01 firstPage",{})[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-left prevPage",{})[0].outerHTML+t.buildTag("input.memberCurrentPage#memberCurrentPage",{},{width:"20px",height:"10px"})[0].outerHTML+t.buildTag("span.memberPageCount#memberPageCount")[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-right nextPage",{})[0].outerHTML+t.buildTag("div.e-icon e-media-forward_01 lastPage",{})[0].outerHTML)[0].outerHTML)[0].outerHTML,ot=t.buildTag("div#"+(e?"clientDialog":this._id+"_clientDialog")+".clientDialog",ut+(!t.isNullOrUndefined(r)&&this.model.pivotControl.model.enableMemberEditorPaging&&(n.parseJSON(r).length>=this.model.pivotControl.model.memberEditorPageSize||this.model.pivotControl.model.memberEditorPageSize<this._memberPageSettings.endPage)?et:"")+ft,{opacity:"1"}).attr("title",i)[0].outerHTML,r=JSON.parse(r),h;for(u=0;u<r.length;u++)r[u].name!=null&&r[u].name.toString().replace(/^\s+|\s+$/gm,"")||(r[u].name="(blank)",r[u].id="(blank)");if(this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?!t.isNullOrUndefined(this.model.pivotControl._fieldMembers):!t.isNullOrUndefined(this._tempFilterData)){if(this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)for(u=0;u<Object.keys(this.model.pivotControl._fieldMembers).length;u++)t.isNullOrUndefined(this.model.pivotControl._fieldMembers[this._curFilteredText])||(h=n.map(this.model.pivotControl._fieldMembers[this._curFilteredText],function(n){if(!n.checked)return n.name}));else for(u=0;u<this._tempFilterData.length;u++)t.isNullOrUndefined(this._tempFilterData[u][i])||(h=this._tempFilterData[u][i]);if(!t.isNullOrUndefined(h))for(u=0;u<h.length;u++)for(c=0;c<r.length;c++)h[u]==r[c].name&&(r[c].checkedStatus=!1)}for(n(ot).appendTo("#"+this._id),this.model.pivotControl.model.enableMemberEditorPaging&&(r.length>=this.model.pivotControl.model.memberEditorPageSize||this.model.pivotControl.model.memberEditorPageSize<this._memberPageSettings.endPage)&&(this.element.find(".prevPage, .firstPage").addClass("pageDisabled"),this.element.find(".nextPage, .lastPage").addClass("pageEnabled"),o=this._memberCount/this.model.pivotControl.model.memberEditorPageSize,o!=Math.round(o)&&(o=parseInt(o)+1),this.element.find(".memberPageCount").html("/ "+o),this.element.find(".memberCurrentPage").val(this._memberPageSettings.currentMemeberPage),this._memberPageSettings.currentMemeberPage>1?this.element.find(".prevPage, .firstPage").removeClass("pageDisabled").addClass("pageEnabled"):this.element.find(".prevPage, .firstPage").removeClass("pageEnabled").addClass("pageDisabled"),this._memberPageSettings.currentMemeberPage==parseInt(this.element.find(".memberPageCount").text().split("/")[1].trim())?this.element.find(".nextPage, .lastPage").removeClass("pageEnabled").addClass("pageDisabled"):this.element.find(".nextPage, .lastPage").removeClass("pageDisabled").addClass("pageEnabled"),this.element.find(".nextPageDiv .pageDisabled").css("opacity","0.5")),this.element.find("#"+this._id+"_SearchEditorTreeView").ejMaskEdit({name:"inputbox",width:"100%",inputMode:t.InputMode.Text,watermarkText:this._getLocalizedLabels("Search")+" "+i,maskFormat:"",textAlign:this.model.enableRTL?"right":"left",change:!this.model.pivotControl.model.enableMemberEditorPaging||this.element.find(".nextPageDiv").length==0?t.proxy(t.Pivot._searchTreeNodes,this):t.proxy(function(n){t.isNullOrUndefined(n.value)&&t.Pivot._searchEditorTreeNodes(n,this)},this)}),this.element.find(".editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,enableRTL:this.model.enableRTL,beforeDelete:function(){return!1},height:n(".memberEditorDiv").height(),fields:{id:"id",text:"name",isChecked:"checkedStatus",hasChild:"hasChildren",dataSource:r}}),e&&(this.element.find(".filterElementTag").ejMenu({fields:{dataSource:nt,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"},menuType:t.MenuType.NormalMenu,width:"100%",enableRTL:this.model.enableRTL,orientation:t.Orientation.Vertical,click:t.proxy(this._filterElementClick,this)}),this.element.find(".groupLabelDrop").ejDropDownList({width:"99%",enableRTL:this.model.enableRTL,dataSource:f,fields:{id:"id",text:"text",value:"value"},change:t.proxy(this._groupLabelChange,this),create:function(){n(this.wrapper.find(".e-input")).focus(function(){n(this).blur()})}}),l=t.isNullOrUndefined(this._selectedLevel)?"":this._selectedLevel,l=n.map(f,function(n){if(n.value.toLowerCase()==l.toLowerCase())return n.text}),y=this.element.find(".groupLabelDrop").data("ejDropDownList"),y.selectItemByText(l.length>0?l[0]:y.model.dataSource[0].text),this.element.find(".memberEditorDiv").addClass("advancedFilter")),tt=n.grep(r,function(n){if(n.hasChildren==!0)return n}).length>0,tt||this.element.find(".memberEditorDiv").addClass("noChildNode"),p=this.element.find(".editorTreeView").find("li"),u=0;u<p.length;u++)p[u].setAttribute("tag",r[u].tag);this.element.find(".dialogOKBtn, .dialogCancelBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this._clientDialogBtnClick:this._dialogBtnClick,this)});this._dialogOKBtnObj=this.element.find(".dialogOKBtn").data("ejButton");this._memberTreeObj=this.element.find(".editorTreeView").data("ejTreeView");var it=this.element.find(".editorTreeView li:gt(0)"),w=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)"),st=n(it).find(":input.nodecheckbox:not(:checked)");st.length>0&&n(w).removeClass("e-checkmark").addClass("e-stop");!t.isNullOrUndefined(this.model.pivotControl)&&this.model.pivotControl.model.enableMemberEditorPaging&&(this._isAllMemberChecked||(this._dialogOKBtnObj.disable(),this.element.find(".dialogOKBtn").attr("disabled","disabled"),n(w).removeClass("e-checkmark").removeClass("e-stop").addClass("e-chk-inact")));!t.isNullOrUndefined(this.model.pivotControl._unSelectedNodes)&&this.model.pivotControl._isMemberPageFilter&&(rt=this.model.pivotControl._unSelectedNodes,n.map(it,function(t){var i=t;n.map(rt,function(t){n(i).attr("tag")==t.tag&&(n(n(i).find("div .e-chkbox-small > span > span:eq(0)")).removeClass("e-checkmark"),n(w).removeClass("e-checkmark").addClass("e-stop"))})}));this.element.find(".clientDialog").ejDialog({width:e?"auto":265,target:"#"+this._id,enableResize:!1,enableRTL:this.model.enableRTL,close:t.proxy(t.Pivot.closePreventPanel,this)});this.element.find(".clientDialog").next(".e-scrollbar").hide();this.element.find(".e-dialog .e-close").attr("title",this._getLocalizedLabels("Close"));e&&(this.element.find("#clientDialog_wrapper").addClass("advancedFilterDlg"),this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.element.find("#clientDialog_wrapper").addClass("advancedFilterDlgOSM"),this.element.find("#clientDialog_wrapper").css("min-width","265px"),this._droppedClass!="schemaFilter"&&(this.element.find(".clientDialog").css("padding","0px").parents().parents().find(".e-titlebar").remove(),a=t.Pivot.getReportItemByFieldName(v,this.model.pivotControl.model.dataSource).item,a&&a.sortOrder&&a.sortOrder!=t.olap.SortOrder.None&&(b=a.sortOrder==t.olap.SortOrder.Descending?"desc":"asc",t.isNullOrUndefined(b)||b=="asc"?this.element.find(".clientDialog .ascImage").addClass("selectedSort"):this.element.find(".clientDialog .descImage").addClass("selectedSort"))));this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this);this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this);this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this._memberTreeObj.model.beforeExpand=t.proxy(this._beforeNodeExpand,this):this._memberTreeObj.model.nodeClick=t.proxy(this._nodeExpand,this);this._memberTreeObj.element.find(".e-plus").length==0&&this._memberTreeObj.element.find(".e-item").css("padding","0px");this._isFiltered=!1;this.model.pivotControl._isMemberPageFilter=!1;t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.hide();t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.hide()},_applySorting:function(){var i=JSON.stringify(this.model.pivotControl.model.customObject),n,r;try{n=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(u){n=this.model.pivotControl.getOlapReport()}this.model.pivotControl.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"sorting",element:this.element,customObject:this.model.customObject});i=JSON.stringify(this.model.pivotControl.model.customObject);r=JSON.stringify({action:"sorting",sortedHeaders:this.model.pivotControl._ascdes,currentReport:n,valueSorting:JSON.stringify(this.model.pivotControl.model.valueSortSettings),customObject:i});this._waitingPopup=this.element.data("ejWaitingPopup");t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show();this.model.pivotControl.model.enableDeferUpdate?t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.hide():this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.sorting,r,this._filterElementSuccess)},_filterElementClick:function(r){var f=this._selectedFieldName,h,s,l,p,c,e,w,o,u;if(this._filterAction=t.isNullOrUndefined(r.element)?r.menuId=="valueFilterBtn"?"valueFiltering":r.menuId=="labelFilterBtn"?"labelFiltering":"":n(r.element).parents("li:eq(0)#valueFilterBtn").length==0?"labelFiltering":"valueFiltering",h=this.element.find(".groupLabelDrop").data("ejDropDownList"),this._selectedLevelUniqueName=h.getSelectedValue(),this.model.pivotControl._selectedField=this._selectedFieldName,this.model.pivotControl&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode){if(this.model.pivotControl._selectedField=this.model.pivotControl._curFilteredText=this._curFilteredText,this.model.pivotControl._curFilteredAxis=this._curFilteredAxis,this._selectedField=this._curFilteredText,this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap)this.model.pivotControl._filterElementClick(r,this);else{try{s=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(b){s=this.model.pivotControl.getOlapReport()}if(u=[],l=this._selectedLevelUniqueName,n(r.element).find(".descImage").length>0||n(r.element).find(".ascImage").length>0||n(r.element).find(".e-clrSort").length>0)return t.isNullOrUndefined(this.model.pivotControl._ascdes)&&(this.model.pivotControl._ascdes=""),this.model.pivotControl._ascdes.indexOf(this._selectedField)>-1?this.model.pivotControl._ascdes=this.model.pivotControl._ascdes.replace(this._selectedField+"##",""):n(r.element).find(".e-clrSort").length==0&&(this.model.pivotControl._ascdes=this.model.pivotControl._ascdes+this._selectedField+"##"),this._applySorting(r),!1;if(n(r.element).find(".e-clrFilter").length>0){this.model.pivotControl._removeFilterTag(this._selectedLevelUniqueName);var a=this._selectedField+"::"+this._curFilteredText+"## Clear Filter"+(this.model.pivotControl&&n(this.model.pivotControl.element).hasClass("e-pivotclient")&&!t.isNullOrUndefined(this.model.pivotControl._ascdes)&&this.model.pivotControl.model.enableAdvancedFilter?">>#>#>>"+this.model.pivotControl._ascdes:""),v=JSON.stringify(this.model.customObject),y=JSON.stringify({action:this._filterAction.toLowerCase(),filterParams:a,sortedHeaders:this._ascdes,currentReport:s,customObject:v,gridLayout:this.model.pivotControl.model.layout});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.filtering,y,this._filterElementSuccess)}else t.Pivot.createAdvanceFilterTag({action:this._filterAction=="labelFiltering"?"labelFilterDlg":"valueFilterDlg",selectedArgs:r,filterInfo:u},this)}return!1}if(n(r.element).attr("id")=="clearAllFilters"?this._clearAllFilter(r):n(r.element).attr("id")=="clearSorting"?this.model.pivotControl._clearSorting(r):(n(r.element).attr("id")=="ascOrder"||n(r.element).attr("id")=="descOrder")&&this._sortField(r),!n(r.element).parent().hasClass("filterElementTag")){if(this.element.find(".e-dialog, .filterDialog, #preventDiv").remove(),n.trim(r.text)==n.trim(this._getLocalizedLabels("ClearFilter")))return this._clearFilter(f,this._selectedLevelUniqueName,this.model.pivotControl.model.dataSource),this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(t.PivotAnalysis._valueFilterArray=n.grep(t.PivotAnalysis._valueFilterArray,function(n){if(n.fieldName!=i&&n.fieldName.toLowerCase()!=f.toLowerCase())return n}),this.model.pivotControl.refreshControl()):t.olap.base.getJSONData({action:"advancedfiltering"},this.model.pivotControl.model.dataSource,this.model.pivotControl),!1;p=!1;c=this._selectedLevelUniqueName;this.model.pivotControl&&(this.model.pivotControl._selectedLevelUniqueName=this._selectedLevelUniqueName);e=this._getAdvancedFiltervalue(f,this._selectedLevelUniqueName);w="";e=n(r.element).find(".activeFilter").length>0&&e.length>0?e[0].values:[""];o=t.Pivot.getReportItemByFieldName(f,this.model.pivotControl.model.dataSource).item;u=[];o&&o.advancedFilter&&(u=n.map(o.advancedFilter,function(n){if(n.name!=i&&n.name.toLowerCase()!=c)return n}));t.Pivot.createAdvanceFilterTag({action:this._filterAction=="labelFiltering"?"labelFilterDlg":"valueFilterDlg",selectedArgs:r,filterInfo:u},this)}},_getAdvancedFiltervalue:function(r,u){if(!(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode)){var f=t.Pivot.getReportItemByFieldName(r,this.model.pivotControl.model.dataSource,"XMLA").item,e=[];return f.advancedFilter&&(e=n.map(f.advancedFilter,function(n){if(n.name!=i&&n.name.toLocaleLowerCase()==u.toLowerCase())return n})),e}return[]},_filterOptionChanged:function(i){var r=this._getAdvancedFiltervalue(this._selectedFieldName,this._selectedLevelUniqueName),u;r=r.length>0?r[0].advancedFilterType=="label"&&i.value.replace(/ /g,"")==r[0].labelFilterOperator?r[0].values:r[0].advancedFilterType=="value"&&i.value.replace(/ /g,"")==r[0].valueFilterOperator?r[0].values:[""]:[""];u=this.element.find(".filterValuesTd")[0];i.value.toLowerCase().indexOf("between")>=0&&n(u).html("<input type='text' id='filterValue1' class='filterValues' value='"+r[0]+"' style='display:inline'/> <span>"+this._getLocalizedLabels("and")+"<\/span> <input type='text' id='filterValue2' value='"+(t.isNullOrUndefined(r[1])?"":r[1])+"' class='filterValues' style='display:inline' /> <\/br>");i.value.toLowerCase().indexOf("between")<0&&n(u).html("<input type='text' id='filterValue1' class='filterValues' value='"+r[0]+"' style='display:inline'/>")},_removeFilterTag:function(i){var r=this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot,u;(i.indexOf("].")>=0||r)&&(u=i.split("].").length>2||r?"levelUniqueName":"hierarchyUniqueName",this._excelFilterInfo.length>0&&(levelName=this._selectedLevelUniqueName,hierarchyName=this._selectedFieldName,this._excelFilterInfo=n.grep(this._excelFilterInfo,function(n){if(n[u]!=i)return n})))},_filterElementOkBtnClick:function(){var f=this.element.find(".filterOptions")[0].value,r=[this.element.find("#filterValue1")[0].value],o=[],l=this._selectedFieldName,p=this._selectedLevelUniqueName.toLowerCase(),s,h,e,c,u;if(this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode){h="";e="";try{s=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(w){s=this.model.pivotControl.getOlapReport()}if(this._removeFilterTag(this._selectedLevelUniqueName),this.model.pivotControl.element.find(".reportlist")&&(h=this.model.pivotControl.element.find(".reportlist").data("ejDropDownList").model.value),t.isNullOrUndefined(this._excelFilterInfo)&&(this._excelFilterInfo=[]),this._filterAction=="labelFiltering"){this.model.pivotControl._excelFilterInfo.push({report:h,action:this._filterAction,hierarchyUniqueName:this._selectedFieldName,levelUniqueName:this._selectedLevelUniqueName,operator:f,measure:e,value1:"",value2:""});c=this._curFilteredText;this._tempFilterData=n.map(this._tempFilterData,function(n){if(!n[c])return n});var a=this._curFilteredAxis+"::"+this._curFilteredText+"##"+f+"::"+r[0]+(this.model.pivotControl&&n(this.model.pivotControl.element).hasClass("e-pivotclient")&&!t.isNullOrUndefined(this.model.pivotControl._ascdes)&&this.model.pivotControl.model.enableAdvancedFilter?">>#>#>>"+this.model.pivotControl._ascdes:""),v=JSON.stringify(this.model.customObject),y=JSON.stringify({action:this._filterAction,filterParams:a,sortedHeaders:this._ascdes,currentReport:s,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:v,gridLayout:this.model.pivotControl.model.layout});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.filtering,y,this._filterElementSuccess)}else{c=this._curFilteredText;this.model.pivotControl._excelFilterInfo.push({report:h,action:this._filterAction,hierarchyUniqueName:this._selectedFieldName,levelUniqueName:this._selectedLevelUniqueName,operator:f,measure:e,value1:"",value2:""});this._tempFilterData=n.map(this._tempFilterData,function(n){if(!n[c])return n});this._measureDDL=this.element.find(".filterMeasures").data("ejDropDownList");e=this._measureDDL.getSelectedValue();var a=this._curFilteredText+"::"+f+"::"+e+"::"+r[0]+"::"+(this.element.find("#filterValue2").length>0?this.element.find("#filterValue2")[0].value:"")+(this.model.pivotControl&&n(this.model.pivotControl.element).hasClass("e-pivotclient")&&!t.isNullOrUndefined(this.model.pivotControl._ascdes)&&this.model.pivotControl.model.enableAdvancedFilter?">>#>#>>"+this.model.pivotControl._ascdes:""),v=JSON.stringify(this.model.customObject),y=JSON.stringify({action:this._filterAction,filterParams:a,sortedHeaders:this._ascdes,currentReport:s,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:v,gridLayout:this.model.layout});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.filtering,y,this._filterElementSuccess)}return!1}if(this._filterAction=="valueFiltering"){if(!(!isNaN(parseFloat(r[0]))&&isFinite(r[0]))||this._measureDDL.getSelectedValue()=="")return;this.element.find("#filterValue2")[0]!=i?","+r.push(this.element.find("#filterValue2")[0].value):r}this.element.find(".e-dialog").remove();u=t.Pivot.getReportItemByFieldName(l,this.model.pivotControl.model.dataSource).item;u&&(delete u.filterItems,u.advancedFilter&&(o=n.map(u.advancedFilter,function(n){if(n.name!=i&&n.name.toLocaleLowerCase()!=p.toLowerCase())return n})),this._filterAction.toLowerCase()=="labelfiltering"?o.push({name:this._selectedLevelUniqueName,labelFilterOperator:f.replace(/ /g,""),advancedFilterType:t.olap.AdvancedFilterType.LabelFilter,values:r}):o.push({name:this._selectedLevelUniqueName,valueFilterOperator:f.replace(/ /g,""),advancedFilterType:t.olap.AdvancedFilterType.ValueFilter,values:r,measure:this._measureDDL.getSelectedValue()}),this.model.pivotControl._currentReportItems=n.grep(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName!=l)return n}),u.advancedFilter=o);this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(t.PivotAnalysis._valueFilterArray=n.grep(t.PivotAnalysis._valueFilterArray,function(n){if(n.fieldName!=i&&n.fieldName.toLowerCase()!=l.toLowerCase())return n}),this._filterAction!="valueFiltering"||t.isNullOrUndefined(u)||t.PivotAnalysis._valueFilterArray.push(u),this.model.pivotControl.refreshControl()):t.olap.base.getJSONData({action:"advancedfiltering"},this.model.pivotControl.model.dataSource,this.model.pivotControl)},_groupLabelChange:function(i){var r=this.element.find(".filterElementTag").data("ejMenu"),u,o,y,f,s,p,h;if(r.disableItemByID("labelClearFilter"),r.disableItemByID("valueClearFilter"),r.disableItemByID("clearAllFilters"),r.disableItemByID("clearSorting"),this.model.pivotControl&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode)return this.model.pivotControl._selectedLevelUniqueName=i.selectedValue,u=[],o=t.buildTag("span.filterState").addClass("e-icon").attr("aria-label","filter state")[0].outerHTML,this.model.pivotControl._excelFilterInfo.length>0&&(s=this.model.pivotControl._selectedLevelUniqueName,y=this.model.pivotControl._selectedFieldName,u=n.map(this.model.pivotControl._excelFilterInfo,function(n){if(n.hierarchyUniqueName==y&&n.levelUniqueName==s)return{action:n.action,operator:n.operator,value1:n.value1}})),this.element.find(".filterElementTag .activeFilter,.filterState").remove(),this.element.find("#labelClearFilter ,#valueClearFilter").css("opacity","0.5").attr("disable",!0),u.length>0&&!t.isNullOrUndefined(u[0].operator)?(f=u[0].action.toLowerCase()=="valuefiltering"?"valueFilterBtn":"labelFilterBtn",f=="labelFilterBtn"?r.enableItemByID("labelClearFilter"):r.enableItemByID("valueClearFilter"),r.enableItemByID("clearAllFilters"),this.element.find("#"+f+" a:eq(0)").append(o),this.element.find("#"+f+" #labelClearFilter").removeAttr("style disable"),this.element.find("#"+f+" #valueClearFilter").removeAttr("style disable"),u[0].operator.replace(/ /g,"")=="BottomCount"?this.element.find("#"+f+" li#"+u[0].operator.replace(/ /g,"").replace("Bottom","top")+" a").append(n(t.buildTag("span.activeFilter e-icon")[0].outerHTML)):this.element.find("#"+f+" li#"+u[0].operator.replace(/ /g,"")+" a").append(n(t.buildTag("span.activeFilter e-icon")[0].outerHTML))):this._getUnSelectedNodes()!=""&&this.element.find(".memberEditorDiv").before("<div class='filterState e-icon' style='top:126px;position:absolute;visibility:hidden'  />"),this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(h=this.element.find("#clearAllFilters a").children().clone(),this.element.find("#clearAllFilters a").text(this._getLocalizedLabels("ClearFilter")+' from "'+i.text+'"').append(h),s=this.model.pivotControl._curFilteredText,p=t.isNullOrUndefined(this.model.pivotControl._ascdes)?[]:n.grep(this.model.pivotControl._ascdes.split("##"),function(n){if(n==s)return n}),p.length>0?(this.element.find(".descImage").addClass("selectedSort"),r.enableItemByID("clearSorting")):this.element.find(".ascImage").addClass("selectedSort")),!1;var e=this,b=this.element.find(".groupLabelDrop").length>0?this.element.find(".groupLabelDrop").data("ejDropDownList"):[],c=e._getAdvancedFiltervalue(e._selectedFieldName,b.getSelectedValue()),r=this.element.find(".filterElementTag").data("ejMenu"),l=t.Pivot.getReportItemByFieldName(e._selectedFieldName,e.model.pivotControl.model.dataSource).item,o=t.buildTag("span.filterState").addClass("e-icon").attr("aria-label","filter state")[0].outerHTML,w=t.buildTag("span.activeFilter").addClass("e-icon")[0].outerHTML,a=t.Pivot.getReportItemByFieldName(e._selectedFieldName,e.model.pivotControl.model.dataSource).item,v;a&&(a.sortOrder&&a.sortOrder!=t.olap.SortOrder.None?(v=a.sortOrder==t.olap.SortOrder.Descending?"desc":"asc",t.isNullOrUndefined(v)||v=="asc"?this.element.find(".clientDialog .ascImage").addClass("selectedSort"):(this.element.find(".clientDialog .descImage").addClass("selectedSort"),r.enableItemByID("clearSorting"))):this.element.find("#clearSorting").css("opacity","0.5").attr("disabled","disabled"));this.element.find("#clearAllFilters").css("opacity","0.5").attr("disabled","disabled");this.element.find(".filterState,.activeFilter").remove();h=this.element.find("#clearAllFilters a").children().clone();this.element.find("#clearAllFilters a").text(this._getLocalizedLabels("ClearFilter")+' from "'+i.text+'"').append(h);c.length>0?(c[0].advancedFilterType==t.olap.AdvancedFilterType.LabelFilter?(this.element.find("#labelFilterBtn a:eq(0)").append(o),this.element.find("#labelFilterBtn .clearFilter").css("opacity","1").removeAttr("disabled"),this.element.find("#labelFilterBtn li#"+c[0].labelFilterOperator+" a").append(w),r.enableItemByID("labelClearFilter")):(this.element.find("#valueFilterBtn a:eq(0)").append(o),this.element.find("#valueFilterBtn .clearFilter").css("opacity","1").removeAttr("disabled"),this.element.find("#valueFilterBtn li#"+c[0].valueFilterOperator+" a").append(w),r.enableItemByID("valueClearFilter")),r.enableItemByID("clearAllFilters"),this.element.find("#clearAllFilters").css("opacity","1").removeAttr("disabled")):(l.length>0&&l[0].filterItems||this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&l&&l.filterItems)&&(this.element.find(".memberEditorDiv").before(o),this.element.find(".filterState").addClass("memberFilter").css("visibility","hidden"),this.element.find("#clearAllFilters").css("opacity","1").removeAttr("disabled"))},_clearAllFilter:function(){var r,u;t.Pivot.closePreventPanel(this);this.element.find(".e-dialog").remove();this._clearFilter(this._selectedFieldName,this._selectedLevelUniqueName,this.model.pivotControl.model.dataSource);r=t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource);r&&r.item&&r.item.filterItems&&(r.item.filterItems.values=[]);this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(u=this._selectedFieldName,t.PivotAnalysis._valueFilterArray=n.grep(t.PivotAnalysis._valueFilterArray,function(n){if(n.fieldName!=i&&n.fieldName.toLowerCase()!=u.toLowerCase())return n}),this.model.pivotControl.refreshControl()):t.olap.base.getJSONData({action:"advancedfiltering"},this.model.pivotControl.model.dataSource,this.model.pivotControl)},_clearFilter:function(r,u,f){var e=t.Pivot.getReportItemByFieldName(r,f);e.item&&e.item.advancedFilter&&(u=this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?r:u,e.item.advancedFilter=n.map(e.item.advancedFilter,function(n){if(n.name!=i&&n.name.toLowerCase()!=u.toLowerCase())return n}))},_createPivotButton:function(i,r,u,f,e){var l="",a="",o,c,w,b,k;if(u&&(l="filtered"),f&&(a="descending"),o=r=="row"?".schemaRow":r=="column"?".schemaColumn":r=="value"?".schemaValue":".schemaFilter",this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)var h=r=="column"?"columns":r=="row"?"rows":r=="filter"?"filters":"values",v=(r=="column"||r=="row")&&this.model.layout!="excel"&&this._dataModel!="Olap"&&this._dataModel!="XMLA"?t.buildTag("span.sorting e-icon "+a).attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML:"",y=(r=="column"||r=="row"||r=="filter")&&this.model.layout!="excel"&&i.fieldCaption!="Measures"?t.buildTag("span.filter e-icon "+l).attr("role","button").attr("aria-label","filter")[0].outerHTML:"",p=this.model.layout!="excel"?t.buildTag("span.removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML:"",s=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+i.fieldName,this.model.pivotControl._dataModel!="XMLA"?n.grep(this.model.pivotTableFields,function(n){return n.name==i.fieldName})[0].caption:i.fieldCaption,{},{fieldName:i.fieldName,fieldCaption:i.fieldCaption,axis:h})[0].outerHTML+y+v+p).attr("tag",h+":"+i.fieldName)[0].outerHTML).attr("tag",h+":"+i.fieldName)[0].outerHTML;else{c="";w={DimensionName:i.fieldName,DimensionHeader:i.fieldCaption,Tag:i.fieldName};t.isNullOrUndefined(this.model.pivotControl)||r!="filter"||(c=t.Pivot._getFilterState("",[],w,this.model.pivotControl));var h=r=="column"?"columns":r=="row"?"rows":r=="filter"?this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Pivot?"filters":"slicers":"values",v=(r=="column"||r=="row")&&this.model.layout!="excel"&&this._dataModel!="Olap"&&this._dataModel!="XMLA"?t.buildTag("span.sorting e-icon "+a).attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML:"",y=(r=="column"||r=="row"||r=="filter")&&this.model.layout!="excel"&&i.fieldCaption!="Measures"?t.buildTag("span.filter e-icon "+l).attr("role","button").attr("aria-label","filter")[0].outerHTML:"",p=this.model.layout!="excel"?t.buildTag("span.removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML:"",s=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+i.fieldName,(this._dataModel=="Pivot"?i.fieldCaption:i=="Measures"?i:!t.isNullOrUndefined(i.fieldCaption)&&i.fieldCaption!=""?i.fieldCaption:i.fieldName.split(".")[1])+(c!=""?" ("+c+")":""),{},{fieldName:i.fieldName,fieldCaption:i.fieldCaption,axis:h})[0].outerHTML+y+v+p).attr("tag",h+":"+i.fieldName)[0].outerHTML).attr("tag",h+":"+(t.isNullOrUndefined(i.fieldName)?i:i.fieldName))[0].outerHTML}typeof e=="number"&&n(this.element.find(o+" .pivotButton")[e]).length>0?r=="row"?n(this.element.find(".schemaRow .pivotButton")[e]).before(s):r=="column"?n(this.element.find(".schemaColumn .pivotButton")[e]).before(s):r=="value"?n(this.element.find(".schemaValue .pivotButton")[e]).before(s):r=="filter"?n(this.element.find(".schemaFilter .pivotButton")[e]).before(s):"":r=="row"?this.element.find(".schemaRow").append(s):r=="column"?this.element.find(".schemaColumn").append(s):r=="value"?this.element.find(".schemaValue").append(s):r=="filter"?this.element.find(".schemaFilter").append(s):"";b=typeof e!="number"&&e==""?" .pivotButton .pvtBtn:last":" .pivotButton .pvtBtn:eq("+e+")";this.model.enableDragDrop&&this.element.find(o+b).ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)});this.element.find(o+" .pivotButton .filterBtn:last").ejButton({size:"normal",enableRTL:this.model.enableRTL,type:t.ButtonType.Button,contentType:"imageonly",prefixIcon:"filter"});this.element.find(o+" .pivotButton input:last").ejToggleButton({size:"normal",enableRTL:this.model.enableRTL,contentType:"imageonly",defaultPrefixIcon:"ascending",activePrefixIcon:"descending",click:t.proxy(this._sortBtnClick,this)});f&&(this.element.find(o+" .pivotButton:contains("+i+") span:eq(0) span").removeClass("ascending").addClass("descending"),this.element.find(o+" .pivotButton:contains("+i+") span:eq(0) button").addClass("e-active"));this.model.pivotControl._dataModel=="XMLA"&&this.element.find(".pivotButton[tag*=':Measures']").length>0&&(k=n(o+" .pivotButton[tag*=':Measures']"),n(o).append(k));this.element.find(".dropIndicator").removeClass("dropIndicatorHover");this._createContextMenu()},_createContextMenu:function(){var r=this.element.find(".pivotButton"),i;this.model.pivotControl!=null&&(i=t.buildTag("ul.pivotTreeContextMenu#pivotTreeContextMenu",t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToFilter"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToRow"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToColumn"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToValues"))[0].outerHTML)[0].outerHTML)[0].outerHTML,n(this.element).append(i),n("#pivotTreeContextMenu").ejMenu({menuType:t.MenuType.ContextMenu,enableRTL:this.model.enableRTL,openOnClick:!1,contextMenuTarget:r,click:t.proxy(this._contextClick,this),beforeOpen:t.proxy(this._onContextOpen,this),close:t.proxy(t.Pivot.closePreventPanel,this)}))},_createPivotButtons_1:function(r,u){var o,e,l,f;if(!t.isNullOrUndefined(r)){if(o="",e=u=="column"?"Columns":u=="row"?"Rows":u=="filter"?"Slicers":"",this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)for(e=u=="column"?"Columns":u=="row"?"Rows":u=="filter"?"Slicers":"values",e=="values"&&this.model.pivotControl._dataModel=="XMLA"&&(r=n.map(r,function(n){return n.measures})),f=0;f<r.length;f++){var a=this.model.pivotControl._dataModel=="XMLA"||this.model.pivotControl._dataModel=="Olap"?"":t.isNullOrUndefined(r[f].filterItems)?"":"filtered",v=this.model.pivotControl._dataModel=="XMLA"||this.model.pivotControl._dataModel=="Olap"?"":r[f].sortOrder==t.PivotAnalysis.SortOrder.Descending?"descending":"",y=this.model.pivotControl._dataModel=="XMLA"?"":r[f].fieldName,s=(u=="column"||u=="row")&&this.model.layout!="excel"&&this.model.pivotControl._dataModel!="Olap"&&this.model.pivotControl._dataModel!="XMLA"?t.buildTag("span.sorting e-icon "+v).attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML:"",h=(u=="column"||u=="row"||u=="filter")&&this.model.layout!="excel"&&r[f].fieldCaption!="Measures"?t.buildTag("span.filter e-icon "+a).attr("role","button").attr("aria-label","filter")[0].outerHTML:"",c=this.model.layout!="excel"?t.buildTag("span.removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML:"";o+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+y,this.model.pivotControl._dataModel=="XMLA"?(r[f].fieldCaption!=i?r[f].fieldCaption:r[f].fieldName)||r[f]:n.grep(this.model.pivotTableFields,function(n){return n.name==r[f].fieldName})[0].caption||n.grep(this.model.pivotTableFields,function(n){return n.name==r[f]})[0].caption,{},{fieldName:r[f].fieldName||r[f],axis:e})[0].outerHTML+h+s+c).attr("tag",e+":"+r[f].fieldName||r[f])[0].outerHTML).attr("tag",e+":"+r[f].fieldName||r[f])[0].outerHTML}else for(e==""&&u=="values"&&(l=this.element.find(".pivotButton:contains("+this._getLocalizedLabels("Measures")+")").length>0?this.element.find(".pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").parent()[0].className.split(" ")[0]:"schemaColumn",e=l=="schemaColumn"?"Columns":"Rows"),f=0;f<r.length;f++){r[f].FieldHeader=r[f].FieldHeader=="Measures"?this._getLocalizedLabels("Measures"):r[f].FieldHeader;var s=(u=="column"||u=="row")&&this.model.layout!="excel"&&this._dataModel!="Olap"&&this._dataModel!="XMLA"?t.buildTag("span.sorting e-icon ").attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML:"",h=(u=="column"||u=="row"||u=="filter")&&this.model.layout!="excel"&&r[f].FieldHeader!="Measures"?t.buildTag("span.filter e-icon").attr("role","button").attr("aria-label","filter")[0].outerHTML:"",c=this.model.layout!="excel"?t.buildTag("span.removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML:"";o+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+r[f].FieldHeader||r[f].FieldName||r[f].Name||r[f].DimensionName,r[f].FieldHeader||r[f].FieldName||r[f].Name||r[f].DimensionName)[0].outerHTML+h+s+c).attr("tag",e+":"+r[f].Tag)[0].outerHTML).attr("tag",e+":"+r[f].Tag)[0].outerHTML}return this._createContextMenu(),o}},_setSplitBtnTargetPos:function(r){var s="",e,u,f,o;if(r.event!=i&&r.event.type=="touchend"?(u=r.event.originalEvent.target!=null?n(r.event.originalEvent.target).parents(".pivotButton"):n(r.event.originalEvent.srcElement).parents(".pivotButton"),f=r.event.originalEvent.target!=null?r.event.originalEvent.target.className:r.event.originalEvent.srcElement.className):(u=t.isNullOrUndefined(r.originalEvent)?n(r.target).parents(".pivotButton"):r.originalEvent.target!=null?n(r.originalEvent.target).parents(".pivotButton"):n(r.originalEvent.srcElement).parents(".pivotButton"),f=t.isNullOrUndefined(r.originalEvent)?n(r.target).attr("class")?n(r.target).attr("class"):"":r.originalEvent.target!=null&&n(r.originalEvent.target).attr("class")?n(r.originalEvent.target).attr("class"):n(r.originalEvent.srcElement).attr("class")?n(r.originalEvent.srcElement).attr("class"):""),this._droppedClass=u.length>0?n(u[0]).parent()[0].className.split(" ")[0]:f.split(" ")[0],u[0]||f!=i&&f!=null&&jQuery.type(f)=="string"&&f.indexOf("pivotButton")>-1)for(u=u[0]?u[0]:r.originalEvent.target!=null?r.originalEvent.target:r.originalEvent.srcElement,e=r.event!=i&&r.event.type=="touchend"?r.target:this._droppedClass!=null&&this._droppedClass!=i&&this._droppedClass!=""?this.element.find("."+this._droppedClass)[0]:u.parentNode,e=n(e).children(".pivotButton"),o=0;o<e.length;o++)n(e[o]).attr("tag")==n(u).attr("tag")&&(s=o);return s},_getUnSelectedNodes:function(){for(var r,f=this.element.find(".editorTreeView")[0],u="",i=n(f).find(":input.nodecheckbox:not(:checked)"),t=0;t<i.length;t++)n(i[t].parentElement).find("span:nth-child(1)").attr("class").indexOf("e-chk-act")>-1||n(i[t].parentElement).attr("aria-checked")=="mixed"||(r=n(i[t]).parents("li:eq(0)"),u+="::"+r[0].id+"||"+n(r).attr("tag"));return u},_getSelectedNodes:function(t){var o,s,e,r,i;if(t){var h=this.element.find(".editorTreeView")[0].childNodes[0],f=[],u=n(h).children();for(r=0;r<u.length;r++){if(i=u[r],o={caption:n(i.firstChild).find("a").text(),parentId:i.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(i).parents()[1].id,id:i.id,checked:n(i).find(":input.nodecheckbox")[0].checked||n(i).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(i.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(i).attr("tag")},n(i).find("ul:first").children().length>0)for(s=n(i).find("ul:first").children(),e=0;e<s.length;e++)o.childNodes.push(this._getNodeInfo(s[e]));f.push(o)}return JSON.stringify(f)}var h=n(".editorTreeView"),f="",u=n(h).find(":input.nodecheckbox");for(r=0;r<u.length;r++)(u[r].checked||n(u[r].parentElement).attr("aria-checked")=="mixed")&&(i=n(u[r]).parents("li:eq(0)"),f+="::"+i[0].id+"||"+n(i).attr("tag"));return f},_getNodeInfo:function(t){var u={caption:n(t.firstChild).find("a").text(),parentId:t.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(t).parents()[1].id,id:t.id,checked:n(t).find(":input.nodecheckbox")[0].checked||n(t).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(t.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(t).attr("tag")},r,i;if(n(t).find("ul:first").children().length>0)for(r=n(t).find("ul:first").children(),i=0;i<r.length;i++)u.childNodes.push(this._getNodeInfo(r[i]));return u},doAjaxPost:function(r,u,f,e,o,s){this.model.pivotControl.model.editCellsInfo={};var h,c,l,a=!0;f.XMLA==i?(h="application/json; charset=utf-8",c="json",l=n.proxy(e,this)):(h="text/xml",c="xml",f=f.XMLA,l=n.proxy(e,this,s),a=!t.isNullOrUndefined(s)&&s.action!="loadFieldElements"?!0:!1);n.ajax({type:r,url:u,contentType:h,dataType:c,async:a,data:f,success:l,complete:n.proxy(o,this),error:function(){this.model.pivotControl._ogridWaitingPopup.hide()}})}});t.PivotSchemaDesigner.Locale={};t.PivotSchemaDesigner.Locale["en-US"]={Sort:"Sort",Search:"Search",SelectField:"select Field",LabelFilterLabel:"Show the items for which the label",ValueFilterLabel:"Show the items for which",ClearSorting:"Clear Sorting",ClearFilterFrom:"Clear Filter From",SortAtoZ:"Sort A to Z",SortZtoA:"Sort Z to A",and:"and",LabelFilters:"Label Filters  ",BeginsWith:"Begins With",DoesNotBeginsWith:"Not Begins With",EndsWith:"Ends With",DoesNotEndsWith:"Not Ends With",Contains:"Contains",DoesNotContains:"Not Contains",ValueFilters:"Value Filters",ClearFilter:"Clear Filter",Equals:"Equals",DoesNotEquals:"Not Equals",GreaterThan:"Greater Than",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThan:"Less Than",LessThanOrEqualTo:"Less Than Or Equal To",Between:"Between",NotBetween:"Not Between",Top10:"Top Count",GreaterThan:"Greater Than",IsGreaterThan:"Is Greater Than",IsGreaterThanOrEqualTo:"Is Greater Than Or Equal To",IsLessThan:"Is Less Than",IsLessThanOrEqualTo:"Is Less Than Or Equal To",ClearFilter:"Clear Filter",SelectField:"Select field",Measures:"Measures",Warning:"Warning",AlertMsg:"The field you are moving cannot be placed in that area of the report",Goal:"Goal",Status:"Status",Trend:"Trend",Value:"value",AddToFilter:"Add to Filter",AddToRow:"Add to Row",AddToColumn:"Add to Column",AddToValues:"Add to Value",PivotTableFieldList:"PivotTable Field List",ChooseFieldsToAddToReport:"Choose fields to add to report:",DragFieldBetweenAreasBelow:"Drag fields between areas below:",ReportFilter:"Filters",ColumnLabel:"Columns",RowLabel:"Rows",Values:"Values",DeferLayoutUpdate:"Defer Layout Update",Update:"Update",OK:"OK",Cancel:"Cancel",Close:"Close"};t.PivotSchemaDesigner.Layouts={Excel:"excel",Normal:"normal",OneByOne:"onebyone"}})(jQuery,Syncfusion)});
